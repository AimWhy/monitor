var MITO=function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function t(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function n(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var o,a,i,s,c,u,l,p,f;!function(e){e.UNKNOWN="UNKNOWN",e.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",e.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",e.LOG_ERROR="LOG_ERROR",e.FETCH_ERROR="HTTP_ERROR",e.VUE_ERROR="VUE_ERROR",e.REACT_ERROR="REACT_ERROR",e.RESOURCE_ERROR="RESOURCE_ERROR",e.PROMISE_ERROR="PROMISE_ERROR",e.ROUTE_ERROR="ROUTE_ERROR"}(o||(o={})),function(e){e.AppOnLaunch="AppOnLaunch",e.AppOnShow="AppOnShow",e.AppOnHide="AppOnHide",e.AppOnError="AppOnError",e.AppOnPageNotFound="AppOnPageNotFound",e.AppOnUnhandledRejection="AppOnUnhandledRejection"}(a||(a={})),function(e){e.PageOnShow="PageOnShow",e.PageOnHide="PageOnHide",e.PageOnShareAppMessage="PageOnShareAppMessage",e.PageOnShareTimeline="PageOnShareTimeline",e.PageOnTabItemTap="PageOnTabItemTap"}(i||(i={})),function(e){e.SwitchTab="switchTab",e.ReLaunch="reLaunch",e.RedirectTo="redirectTo",e.NavigateTo="navigateTo",e.NavigateBack="navigateBack",e.RouteFail="routeFail"}(s||(s={})),e(e(e({},a),i),o),function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.XHR="Xhr",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.VUE="Vue",e.REACT="React",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer",e.APP_ON_SHOW="App On Show",e.APP_ON_LAUNCH="App On Launch",e.APP_ON_HIDE="App On Hide",e.PAGE_ON_SHOW="Page On Show",e.PAGE_ON_HIDE="Page On Hide",e.PAGE_ON_SHARE_APP_MESSAGE="Page On Share App Message",e.PAGE_ON_SHARE_TIMELINE="Page On Share Timeline",e.PAGE_ON_TAB_ITEM_TAP="Page On Tab Item Tap",e.TAP="UI.Tap",e.TOUCHMOVE="UI.Touchmove"}(c||(c={})),function(e){e.HTTP="http",e.USER="user",e.DEBUG="debug",e.EXCEPTION="exception",e.LIFECYCLE="lifecycle"}(u||(u={})),function(e){e.XHR="xhr",e.FETCH="fetch",e.CONSOLE="console",e.DOM="dom",e.HISTORY="history",e.ERROR="error",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.MITO="mito",e.VUE="Vue",e.MINI_ROUTE="miniRoute"}(l||(l={})),function(e){e.XHR="xhr",e.FETCH="fetch"}(p||(p={})),function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(f||(f={}));var d,h=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/,E={isLogAddBreadcrumb:!0,crossOriginThreshold:1e3};!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(d||(d={}));var R="https://trycatch-end.qa.91jkys.com/errors/",g=["Request failed with status code 401","undefined","","Error: Request failed with status code 401","cancel","false"];function O(e,r){return void 0===r&&(r=!1),t(this,void 0,void 0,(function(){return n(this,(function(t){return[2,new Promise((function(t,n){var o=new XMLHttpRequest;o.open(d.Get,(r?R:"https://trycatch-end.91jkys.com/errors/")+"detection/errorId/"+e.data.errorId),o.send(),o.onreadystatechange=function(){if(4===o.readyState)try{JSON.parse(o.responseText).data&&t(!0),n(!1)}catch(e){n(!1)}}}))]}))}))}function m(e,r,a){return void 0===a&&(a=!1),t(this,void 0,void 0,(function(){var t,i;return n(this,(function(n){switch(n.label){case 0:switch(t=e.data,i=["ResizeObserver loop limit exceeded","Script error.","Unexpected identifier"],t.type){case o.JAVASCRIPT_ERROR:if(-1!==i.indexOf(t.message.trim()))return[2,!1];case o.PROMISE_ERROR:if(s=t.message,-1!==g.indexOf(s.trim()))return[2,!1]}if(!t.customTag&&r&&(t.customTag=r),!(e.record&&Array.isArray(e.record)&&e.record.length>2&&function(e){var t=e.data;if([o.VUE_ERROR,o.JAVASCRIPT_ERROR,o.LOG_ERROR,o.REACT_ERROR,o.FETCH_ERROR].indexOf(t.type))return!0}(e)&&Math.round(100*Math.random())<16))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,O(e,a)];case 2:return n.sent(),[3,4];case 3:return n.sent(),e.record=[],[3,4];case 4:return[2,e]}var s}))}))}var y=Object.prototype.toString;function v(e){return function(t){return y.call(t)==="[object "+e+"]"}}var b={isNumber:v("Number"),isString:v("String"),isBoolean:v("Boolean"),isNull:v("Null"),isUndefined:v("Undefined"),isSymbol:v("Symbol"),isFunction:v("Function"),isObject:v("Object"),isArray:v("Array"),isProcess:v("process"),isWindow:v("Window")};function T(e){switch(y.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}var N=b.isProcess("undefined"!=typeof process?process:0),A=b.isObject("undefined"!=typeof wx?wx:0)&&b.isFunction("undefined"!=typeof App?App:0),_=b.isWindow("undefined"!=typeof window?window:0);var I=_?window:A?wx:N?process:void 0,C=(I.__MITO__=I.__MITO__||{},I.__MITO__);C.replaceFlag=C.replaceFlag||{};var S=C.replaceFlag;function x(e,t){S[e]||(S[e]=t)}function U(e){return!!S[e]}var H="MITO Logger",P=function(){function e(){var e=this;if(this.enabled=!1,this._console={},I.console=console||I.console,console||I.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in I.console&&(e._console[t]=I.console[t])}))}}return e.prototype.disable=function(){this.enabled=!1},e.prototype.bindOptions=function(e){this.enabled=!!e},e.prototype.enable=function(){this.enabled=!0},e.prototype.getEnableStatus=function(){return this.enabled},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).log.apply(e,r([H+"[Log]:"],t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).warn.apply(e,r([H+"[Warn]:"],t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).error.apply(e,r([H+"[Error]:"],t))},e}(),k=C.logger||(C.logger=new P);function w(){return"undefined"==typeof document||null==document.location?"":document.location.href}function D(e,t,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)}function L(e,t,n,r){if(void 0===r&&(r=!1),t in e||r){var o=n(e[t]);"function"==typeof o&&(e[t]=o)}}function F(){return Date.now()}function M(e,t,n){return!!function(e,t){return typeof e===t}(e,n)||(void 0!==e&&k.error(t+"期望传入"+n+"类型，目前是"+typeof e+"类型"),!1)}function j(e,t,n){return!!function(e,t){return y.call(e)===t}(e,n)||(void 0!==e&&k.error(t+"期望传入"+n+"类型，目前是"+y.call(e)+"类型"),!1)}function V(e){E.isLogAddBreadcrumb=!1,e(),E.isLogAddBreadcrumb=!0}function X(e){return b.isString(e)?e:b.isUndefined(e)?"undefined":JSON.stringify(e)}function B(e){return Number(e.split(".")[0])}function G(){if(!b.isFunction(getCurrentPages))return"";var e=getCurrentPages();if(!e.length)return"App";var t,n,r,o=e.pop();return t=o.route,n=o.options,r=[],Object.keys(n).forEach((function(e){r.push(e+"="+n[e])})),t=-1!==t.indexOf("?")?t+"&"+r.join("&"):t+"?"+r.join("&")}function q(e){if(!e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function W(t,n){var r={time:F(),url:w(),name:t.name,level:n,message:t.message};if(void 0===t.stack||!t.stack)return r;for(var a,i,s,c=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,u=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,l=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,p=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,f=/\((\S*)(?::(\d+))(?::(\d+))\)/,d=t.stack.split("\n"),h=[],E=0,R=d.length;E<R;++E){if(i=c.exec(d[E])){var g=i[2]&&0===i[2].indexOf("native");i[2]&&0===i[2].indexOf("eval")&&(a=f.exec(i[2]))&&(i[2]=a[1],i[3]=a[2],i[4]=a[3]),s={url:g?null:i[2],func:i[1]||o.UNKNOWN_FUNCTION,args:g?[i[2]]:[],line:i[3]?+i[3]:null,column:i[4]?+i[4]:null}}else if(i=l.exec(d[E]))s={url:i[2],func:i[1]||o.UNKNOWN_FUNCTION,args:[],line:+i[3],column:i[4]?+i[4]:null};else{if(!(i=u.exec(d[E])))continue;i[3]&&i[3].indexOf(" > eval")>-1&&(a=p.exec(i[3]))?(i[3]=a[1],i[4]=a[2],i[5]=null):0!==E||i[5]||void 0===t.columnNumber||(h[0].column=t.columnNumber+1),s={url:i[3],func:i[1]||o.UNKNOWN_FUNCTION,args:i[2]?i[2].split(","):[],line:i[4]?+i[4]:null,column:i[5]?+i[5]:null}}!s.func&&s.line&&(s.func=o.UNKNOWN_FUNCTION),h.push(s)}return h.length?e(e({},r),{stack:h}):null}var $,J,K=function(){function e(){this.stack=[],this.isFlushing=!1,"Promise"in I&&(this.micro=Promise.resolve())}return e.prototype.addFn=function(e){var t=this;"function"==typeof e&&("Promise"in I?(this.stack.push(e),this.isFlushing||(this.isFlushing=!0,this.micro.then((function(){return t.flushStack()})))):e())},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.flushStack=function(){var e=this.stack.slice(0);this.stack.length=0,this.isFlushing=!1;for(var t=0;t<e.length;t++)e[t]()},e}();!function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}($||($={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":case"log":case"assert":return e.Info;case"warn":case"warning":return e.Warning;case e.Low:case e.Normal:case e.High:case e.Critical:case"error":return e.Error;default:return e.Else}}}($||($={})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(J||(J={}));var Y=function(){function e(){this.maxBreadcrumbs=10,this.beforePushBreadcrumb=null,this.stack=[]}return e.prototype.push=function(e){var t=this;if("function"!=typeof this.beforePushBreadcrumb)this.immediatePush(e);else{var n=null,r=this.beforePushBreadcrumb;if(V((function(){n=r(t,e)})),!n)return;this.immediatePush(n)}},e.prototype.immediatePush=function(e){e.time=F(),this.stack.length>=this.maxBreadcrumbs&&this.shift(),this.stack.push(e),k.log(this.stack)},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.getCategory=function(e){switch(e){case c.XHR:case c.FETCH:return u.HTTP;case c.CLICK:case c.ROUTE:case c.TAP:case c.TOUCHMOVE:return u.USER;case c.CUSTOMER:case c.CONSOLE:return u.DEBUG;case c.APP_ON_LAUNCH:case c.APP_ON_SHOW:case c.APP_ON_HIDE:case c.PAGE_ON_SHOW:case c.PAGE_ON_HIDE:case c.PAGE_ON_SHARE_APP_MESSAGE:case c.PAGE_ON_SHARE_TIMELINE:case c.PAGE_ON_TAB_ITEM_TAP:return u.LIFECYCLE;case c.UNHANDLEDREJECTION:case c.CODE_ERROR:case c.RESOURCE:case c.VUE:case c.REACT:default:return u.EXCEPTION}},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.maxBreadcrumbs,n=e.beforePushBreadcrumb;M(t,"maxBreadcrumbs","number")&&(this.maxBreadcrumbs=t),M(n,"beforePushBreadcrumb","function")&&(this.beforePushBreadcrumb=n)},e}(),Z=C.breadcrumb||(C.breadcrumb=new Y),Q={};function z(e,t){var n;switch(e.type){case o.FETCH_ERROR:n=e.type+e.request.method+e.response.status+te(e.request.url)+t;break;case o.JAVASCRIPT_ERROR:case o.VUE_ERROR:case o.REACT_ERROR:n=e.type+e.name+e.message+t;break;case o.LOG_ERROR:n=e.customTag+e.type+e.name+t;break;case o.PROMISE_ERROR:n=function(e,t){var n=te(e.url);if(e.name===l.UNHANDLEDREJECTION)return e.type+ee(e.message)+t;return e.type+e.name+ee(e.message)+n}(e,t);break;default:n=e.type+e.message+t}return n=function(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(n),Q[n]>1?null:("number"==typeof Q[n]?Q[n]++:Q[n]=1,n)}function ee(e){var t=function(e){return Object.keys(e).sort().reduce((function(n,r){return b.isObject(e[r])?n[r]=t(e[r]):n[r]=e[r],n}),{})};try{if(/\{.*\}/.test(e)){var n=JSON.parse(e);return n=t(n),JSON.stringify(n)}}catch(t){return e}}function te(e){return e.replace(/[\?#].*$/,"").replace(/\/\d+([\/]*$)/,"{param}$1")}var ne=function(){function e(e){this.url=e,this.beforeDataReport=null,this.backTrackerId=null,this.configReportXhr=null,this.apikey="",this.queue=new K}return e.prototype.getRecord=function(){var e=C.record;return e&&b.isArray(e)&&e.length>2?e:[]},e.prototype.beforePost=function(e){return t(this,void 0,void 0,(function(){var t,r;return n(this,(function(n){switch(n.label){case 0:return(t=z(e,this.apikey))?(e.errorId=t,r=this.getTransportData(e),"function"!=typeof this.beforeDataReport?[3,2]:[4,this.beforeDataReport(r)]):[2,!1];case 1:if(!(r=n.sent()))return[2,!1];n.label=2;case 2:return[2,JSON.stringify(r)]}}))}))},e.prototype.xhrPost=function(e){return t(this,void 0,void 0,(function(){var t,r,o=this;return n(this,(function(n){switch(n.label){case 0:return[4,this.beforePost(e)];case 1:return(t=n.sent())?(r=function(){var e=new XMLHttpRequest;e.open(d.Post,o.url),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.withCredentials=!0,"function"==typeof o.configReportXhr&&o.configReportXhr(e),e.send(t)},this.queue.addFn(r),[2]):[2]}}))}))},e.prototype.wxPost=function(e){return t(this,void 0,void 0,(function(){var t,r,o=this;return n(this,(function(n){switch(n.label){case 0:return[4,this.beforePost(e)];case 1:return(t=n.sent())?(r=function(){wx.request({method:"POST",header:{"Content-Type":"application/json;charset=UTF-8"},url:o.url,data:t})},this.queue.addFn(r),[2]):[2]}}))}))},e.prototype.getAuthInfo=function(){var e=this.getTrackerId();return{trackerId:String(e),sdkVersion:"2.0.0",sdkName:"mitojs",apikey:this.apikey}},e.prototype.getApikey=function(){return this.apikey},e.prototype.getTrackerId=function(){if("function"==typeof this.backTrackerId){var e=this.backTrackerId();if("string"==typeof e||"number"==typeof e)return e;k.error("trackerId:"+e+" 期望 string 或 number 类型，但是传入 "+typeof e)}return""},e.prototype.getTransportData=function(e){return{authInfo:this.getAuthInfo(),breadcrumb:Z.getStack(),data:e,record:this.getRecord()}},e.prototype.isSdkTransportUrl=function(e){return-1!==e.indexOf(this.url)},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.dsn,n=e.beforeDataReport,r=e.apikey,o=e.configReportXhr,a=e.backTrackerId;M(r,"apikey","string")&&(this.apikey=r),M(t,"dsn","string")&&(this.url=t),M(n,"beforeDataReport","function")&&(this.beforeDataReport=n),M(o,"configReportXhr","function")&&(this.configReportXhr=o),M(a,"backTrackerId","function")&&(this.backTrackerId=a)},e.prototype.send=function(e){return _?this.xhrPost(e):A?this.wxPost(e):void 0},e}(),re=C.transportData||(C.transportData=new ne("//localhost:3000/api/error/upload"));function oe(t){var n=t.message,r=void 0===n?"emptyMsg":n,a=t.tag,i=void 0===a?"":a,s=t.level,u=void 0===s?$.Critical:s,l=t.ex,p=void 0===l?"":l,f={};T(p)&&(f=W(p,u));var d=e({type:o.LOG_ERROR,level:u,message:X(r),name:"MITO.log",customTag:X(i),time:F(),url:A?G():w()},f);Z.push({type:c.CUSTOMER,category:Z.getCategory(c.CUSTOMER),data:r,level:$.fromString(u.toString())}),re.send(d)}function ae(e){var t="",n=e.elapsedTime,r=e.time,a=e.method,i=e.traceId,s=e.type,c=e.status,u=s+"--"+a;return t=(t=0===c?n<=E.crossOriginThreshold?"http请求失败，失败原因：跨域限制或域名不存在":"http请求失败，失败原因：超时":function(e){if(e<400)return J.Ok;if(e>=400&&e<500)switch(e){case 401:return J.Unauthenticated;case 403:return J.PermissionDenied;case 404:return J.NotFound;case 409:return J.AlreadyExists;case 413:return J.FailedPrecondition;case 429:return J.ResourceExhausted;default:return J.InvalidArgument}if(e>=500&&e<600)switch(e){case 501:return J.Unimplemented;case 503:return J.Unavailable;case 504:return J.DeadlineExceeded;default:return J.InternalError}return J.UnknownError}(c))===J.Ok?t:t+" "+te(e.url),{type:o.FETCH_ERROR,url:w(),time:r,elapsedTime:n,level:$.Low,message:t,name:u,request:{httpType:s,traceId:i,method:a,url:e.url,data:e.reqData||""},response:{status:c,data:e.responseText}}}var ie={img:"图片",script:"js脚本"};var se=function(){function e(){this.traceIdFieldName="Trace-Id",this.enableTraceId=!1}return e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.beforeAppAjaxSend,n=e.enableTraceId,r=e.filterXhrUrlRegExp,o=e.traceIdFieldName,a=e.includeHttpUrlTraceIdRegExp;M(t,"beforeAppAjaxSend","function")&&(this.beforeAppAjaxSend=t),M(n,"enableTraceId","boolean")&&(this.enableTraceId=n),M(o,"traceIdFieldName","string")&&(this.traceIdFieldName=o),j(r,"filterXhrUrlRegExp","[object RegExp]")&&(this.filterXhrUrlRegExp=r),j(a,"includeHttpUrlTraceIdRegExp","[object RegExp]")&&(this.includeHttpUrlTraceIdRegExp=a)},e}(),ce=C.options||(C.options=new se);function ue(e,t){var n,r=ce.includeHttpUrlTraceIdRegExp;if(ce.enableTraceId&&r&&r.test(e)){var o=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})));t(ce.traceIdFieldName,o)}}var le={};function pe(e,t){e&&le[e]&&le[e].forEach((function(n){!function(e,t){try{e()}catch(e){console.log("err",e),t&&t(e)}}((function(){n(t)}),(function(t){var r;k.error("重写事件triggerHandlers的回调函数发生错误\nType:"+e+"\nName: "+(((r=n)&&"function"==typeof r&&r.name||"<anonymous>")+"\nError: ")+t)}))}))}function fe(t,n,r,a,i,s){var u=null==s?void 0:s.version,l={type:o.VUE_ERROR,message:t.message+"("+r+")",level:a,url:w(),name:t.name,stack:t.stack||[],time:F()};if(b.isString(u))switch(console.log("getBigVersion",B(u)),B(u)){case 2:l=e(e({},l),function(e){var t="";if(e.$root===e)t="root";else{var n=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name;t=(n?"component <"+n+">":"anonymous component")+(e._isVue&&e.$options&&e.$options.__file?" at "+(e.$options&&e.$options.__file):"")}return{componentName:t,propsData:e.$options&&e.$options.propsData}}(n));break;case 3:l=e(e({},l),function(e){var t="";if(e.$root===e)t="root";else{console.log(e.$options);var n=e.$options&&e.$options.name;t=n?"component <"+n+">":"anonymous component"}return{componentName:t,propsData:e.$props}}(n));break;default:return}Z.push({type:c.VUE,category:Z.getCategory(c.VUE),data:l,level:i}),re.send(l)}var de="undefined"!=typeof console,he={install:function(e){!U(l.VUE)&&e&&e.config&&(x(l.VUE,!0),e.config.errorHandler=function(t,n,r){fe.apply(null,[t,n,r,$.Normal,$.Error,e]),de&&!e.config.silent&&V((function(){console.error("Error in "+r+': "'+t.toString()+'"',n),console.error(t)}))})}};var Ee,Re,ge,Oe,me={handleHttp:function(t,n){var r=0===t.status||t.status===f.BAD_REQUEST||t.status>f.UNAUTHORIZED,o=ae(t);Z.push({type:n,category:Z.getCategory(n),data:e({},o),level:$.Info}),r&&(Z.push({type:n,category:Z.getCategory(c.CODE_ERROR),data:e({},o),level:$.Error}),re.send(o))},handleError:function(t){if(t.target.localName){var n=function(e){return{type:o.RESOURCE_ERROR,url:w(),message:"资源地址: "+(e.src.slice(0,100)||e.href.slice(0,100)),level:$.Low,time:F(),name:(ie[e.localName]||e.localName)+"加载失败"}}(t.target);return Z.push({type:c.RESOURCE,category:Z.getCategory(c.RESOURCE),data:n,level:$.Error}),re.send(n)}var r,a=t.message,i=t.filename,s=t.lineno,u=t.colno,l=t.error;l&&T(l)&&(r=W(l,$.Normal)),r||(r=me.handleNotErrorInstance(a,i,s,u)),r.type=o.JAVASCRIPT_ERROR,Z.push({type:c.CODE_ERROR,category:Z.getCategory(c.CODE_ERROR),data:e({},r),level:$.Error}),re.send(r)},handleNotErrorInstance:function(e,t,n,r){var a=o.UNKNOWN,i=t||w(),s=e,c=e.match(h);c[1]&&(a=c[1],s=c[2]);var u={url:i,func:o.UNKNOWN_FUNCTION,args:o.UNKNOWN,line:n,col:r};return{url:i,name:a,message:s,level:$.Normal,time:F(),stack:[u]}},handleHistory:function(e){var t=e.from,n=e.to,r=q(t).relative,o=q(n).relative;Z.push({type:c.ROUTE,category:Z.getCategory(c.ROUTE),data:{from:r||"/",to:o||"/"},level:$.Info})},handleHashchange:function(e){var t=e.oldURL,n=e.newURL,r=q(t).relative,o=q(n).relative;Z.push({type:c.ROUTE,category:Z.getCategory(c.ROUTE),data:{from:r,to:o},level:$.Info})},handleUnhandleRejection:function(t){var n={type:o.PROMISE_ERROR,message:X(t.reason),url:w(),name:t.type,time:F(),level:$.Low};T(t.reason)&&(n=e(e({},n),W(t.reason,$.Low))),Z.push({type:c.UNHANDLEDREJECTION,category:Z.getCategory(c.UNHANDLEDREJECTION),data:e({},n),level:$.Error}),re.send(n)}},ye=(Ee=pe,Re=600,ge=!0,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ge&&(Ee.apply(this,e),ge=!1,setTimeout((function(){ge=!0}),Re))});function ve(e){return ce.filterXhrUrlRegExp&&ce.filterXhrUrlRegExp.test(e)}function be(t){switch(t){case l.XHR:!function(){if(!("XMLHttpRequest"in I))return;var e=XMLHttpRequest.prototype;L(e,"open",(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.mito_xhr={method:b.isString(t[0])?t[0].toUpperCase():t[0],url:t[1],sTime:F(),type:p.XHR},e.apply(this,t)}})),L(e,"send",(function(e){return function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=this.mito_xhr,a=o.method,i=o.url;ue(i,(function(e,n){t.mito_xhr.traceId=n,t.setRequestHeader(e,n)})),ce.beforeAppAjaxSend&&ce.beforeAppAjaxSend({method:a,url:i},this),D(this,"loadend",(function(){if(!(a===d.Post&&re.isSdkTransportUrl(i)||ve(i))){var e=this.responseType,t=this.response,r=this.status;this.mito_xhr.reqData=n[0];var o=F();this.mito_xhr.time=o,this.mito_xhr.status=r,-1!==["","json","text"].indexOf(e)&&(this.mito_xhr.responseText="object"==typeof t?JSON.stringify(t):t),this.mito_xhr.elapsedTime=o-this.mito_xhr.sTime,pe(l.XHR,this.mito_xhr)}})),e.apply(this,n)}}))}();break;case l.FETCH:!function(){if(!("fetch"in I))return;L(I,l.FETCH,(function(t){return function(n,r){void 0===r&&(r={});var o=F(),a=r&&r.method||"GET",i={type:p.FETCH,method:a,reqData:r&&r.body,url:n},s=new Headers(r.headers||{});return Object.assign(s,{setRequestHeader:s.set}),ue(n,(function(e,t){i.traceId=t,s.set(e,t)})),ce.beforeAppAjaxSend&&ce.beforeAppAjaxSend({method:a,url:n},s),r=e(e({},r),{headers:s}),t.apply(I,[n,r]).then((function(t){var r=t.clone(),s=F();return i=e(e({},i),{elapsedTime:s-o,status:r.status,time:s}),r.text().then((function(e){a===d.Post&&re.isSdkTransportUrl(n)||ve(n)||(i.responseText=r.status>f.UNAUTHORIZED&&e,pe(l.FETCH,i))})),t}),(function(t){var r=F();if(!(a===d.Post&&re.isSdkTransportUrl(n)||ve(n)))throw i=e(e({},i),{elapsedTime:r-o,status:0,time:r}),pe(l.FETCH,i),t}))}}))}();break;case l.ERROR:D(I,"error",(function(e){pe(l.ERROR,e)}),!0);break;case l.CONSOLE:!function(){if(!("console"in I))return;["log","debug","info","warn","error","assert"].forEach((function(e){e in I.console&&L(I.console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&(pe(l.CONSOLE,{args:n,level:e}),t.apply(I.console,n))}}))}))}();break;case l.HISTORY:!function(){if(e=I.chrome,t=e&&e.app&&e.app.runtime,n="history"in I&&!!I.history.pushState&&!!I.history.replaceState,t||!n)return;var e,t,n;var r=I.onpopstate;function o(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length>2?t[2]:void 0;if(r){var o=Oe,a=String(r);Oe=a,pe(l.HISTORY,{from:o,to:a})}return e.apply(this,t)}}I.onpopstate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=w(),o=Oe;pe(l.HISTORY,{from:o,to:n}),r&&r.apply(this,e)},L(I.history,"pushState",o),L(I.history,"replaceState",o)}();break;case l.UNHANDLEDREJECTION:D(I,l.UNHANDLEDREJECTION,(function(e){pe(l.UNHANDLEDREJECTION,e)}));break;case l.DOM:!function(){if(!("document"in I))return;D(I.document,"click",(function(){ye(l.DOM,{category:"click",data:this})}),!0)}();break;case l.HASHCHANGE:n="onpopstate",I.hasOwnProperty(n)||D(I,l.HASHCHANGE,(function(e){pe(l.HASHCHANGE,e)}))}var n}function Te(e){(function(e){return!(!e||U(e.type))&&(x(e.type,!0),le[e.type]=le[e.type]||[],le[e.type].push(e.callback),!0)})(e)&&be(e.type)}function Ne(){Te({callback:function(e){me.handleHttp(e,c.XHR)},type:l.XHR}),Te({callback:function(e){me.handleHttp(e,c.FETCH)},type:l.FETCH}),Te({callback:function(e){me.handleError(e)},type:l.ERROR}),Te({callback:function(e){!function(e){E.isLogAddBreadcrumb&&Z.push({type:c.CONSOLE,category:Z.getCategory(c.CONSOLE),data:e,level:$.fromString(e.level)})}(e)},type:l.CONSOLE}),Te({callback:function(e){me.handleHistory(e)},type:l.HISTORY}),Te({callback:function(e){me.handleUnhandleRejection(e)},type:l.UNHANDLEDREJECTION}),Te({callback:function(e){var t=function(e){var t=e.tagName.toLowerCase();if("body"===t)return null;var n=e.classList.value;return n=""!==n?' class="'+n+'"':"","<"+t+(e.id?' id="'+e.id+'"':"")+(""!==n?n:"")+">"+e.innerText+"</"+t+">"}(e.data.activeElement);t&&Z.push({type:c.CLICK,category:Z.getCategory(c.CLICK),data:t,level:$.Info})},type:l.DOM}),Te({callback:function(e){me.handleHashchange(e)},type:l.HASHCHANGE})}function Ae(e){var t;void 0===e&&(e={}),void 0===(t=e)&&(t={}),x(l.XHR,!!t.silentXhr),x(l.FETCH,!!t.silentFetch),x(l.CONSOLE,!!t.silentConsole),x(l.DOM,!!t.silentDom),x(l.HISTORY,!!t.silentHistory),x(l.ERROR,!!t.silentError),x(l.HASHCHANGE,!!t.silentHashchange),x(l.UNHANDLEDREJECTION,!!t.silentUnhandledrejection),x(l.VUE,!!t.silentVue),x(a.AppOnError,!!t.silentWxOnError),x(a.AppOnUnhandledRejection,!!t.silentUnhandledrejection),x(a.AppOnPageNotFound,!!t.silentWxOnPageNotFound),x(i.PageOnShareAppMessage,!!t.silentWxOnShareAppMessage),x(l.MINI_ROUTE,!!t.silentMiniRoute),Z.bindOptions(e),k.bindOptions(e.debug),re.bindOptions(e),ce.bindOptions(e)}function _e(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t="emptyMsg"),void 0===n&&(n=""),void 0===r&&(r=$.Critical),oe({message:t,tag:e,ex:n,level:r})}function Ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length>0&&("string"==typeof e[0]?_e.apply(void 0,e):oe(e[0]))}Oe=w();var Ce=/apigw/;return function(e,t){void 0===t&&(t=!1);var n=document.querySelector("script[apikey]"),r=null,o="false";n&&(r=n.getAttribute("apikey"),o=n.getAttribute("debug"));var a=-1!==location.href.indexOf(".qa.")||-1!==location.href.indexOf("localhost")||-1!==location.href.indexOf("127.0.0.1");(t?a:!a)&&r&&(I.Vue&&he.install(I.Vue),document.addEventListener("DOMContentLoaded",(function(){he.install(I.Vue)})),I.tryCatch={log:Ie},e({customTag:n.getAttribute("customTag"),apikey:r,debug:"true"===o}))}((function(e){var t=e.customTag,n=e.apikey,r=e.debug;!function(e){void 0===e&&(e={}),"addEventListener"in document&&!e.disabled&&(Ae(e),Ne())}({maxBreadcrumbs:20,apikey:n,enableTraceId:!0,includeHttpUrlTraceIdRegExp:Ce,debug:r,dsn:R+"upload",silentConsole:!0,beforePushBreadcrumb:function(e,t){return function(e,t){if(t.category===u.HTTP){var n=t.data;n.response.status>=200&&n.response.status<300&&(n.response.data="")}return t}(0,t)},beforeDataReport:function(e){return m(e,t,!0)},beforeAppAjaxSend:function(e,t){return function(e,t){e.method;var n=e.url;if(/apigw/.test(n)){var r=window.navigator.userAgent,o=window.APP_INFO||null,a=r.match(/AppInfo\((.*?);(.*?);/);a&&a.length>=3&&(o=a[1]+";version="+a[2]+";platform=H5");var i=null,s=r.match(/DeviceId\((.*?)\)/);s&&s.length>=2&&(i=s[1]),o&&t.setRequestHeader("App-Info",o),i&&t.setRequestHeader("Device-Id",i)}}({method:e.method,url:e.url},t)}})}),!0),{MitoVue:he,SDK_VERSION:"2.0.0",SDK_NAME:"mitojs",log:Ie,errorBoundaryReport:function(e){if(T(e)){var t=W(e,$.Normal);t.type=o.REACT_ERROR,Z.push({type:c.REACT,category:Z.getCategory(c.REACT),data:t.name+": "+t.message,level:$.fromString(t.level)}),re.send(t)}else console.warn("传入的react error不是一个object Error")}}}();
