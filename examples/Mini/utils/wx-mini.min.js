var MITO=function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function r(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function o(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var i,a,s,c,u,p,l,f,h;!function(e){e.UNKNOWN="UNKNOWN",e.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",e.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",e.LOG_ERROR="LOG_ERROR",e.FETCH_ERROR="HTTP_ERROR",e.VUE_ERROR="VUE_ERROR",e.REACT_ERROR="REACT_ERROR",e.RESOURCE_ERROR="RESOURCE_ERROR",e.PROMISE_ERROR="PROMISE_ERROR",e.ROUTE_ERROR="ROUTE_ERROR"}(i||(i={})),function(e){e.AppOnLaunch="AppOnLaunch",e.AppOnShow="AppOnShow",e.AppOnHide="AppOnHide",e.AppOnError="AppOnError",e.AppOnPageNotFound="AppOnPageNotFound",e.AppOnUnhandledRejection="AppOnUnhandledRejection"}(a||(a={})),function(e){e.PageOnShow="PageOnShow",e.PageOnHide="PageOnHide",e.PageOnShareAppMessage="PageOnShareAppMessage",e.PageOnShareTimeline="PageOnShareTimeline",e.PageOnTabItemTap="PageOnTabItemTap"}(s||(s={})),function(e){e.SwitchTab="switchTab",e.ReLaunch="reLaunch",e.RedirectTo="redirectTo",e.NavigateTo="navigateTo",e.NavigateBack="navigateBack",e.NavigateToMiniProgram="navigateToMiniProgram",e.RouteFail="routeFail"}(c||(c={})),t(t(t({},a),s),i),function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.XHR="Xhr",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.VUE="Vue",e.REACT="React",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer",e.APP_ON_SHOW="App On Show",e.APP_ON_LAUNCH="App On Launch",e.APP_ON_HIDE="App On Hide",e.PAGE_ON_SHOW="Page On Show",e.PAGE_ON_HIDE="Page On Hide",e.PAGE_ON_SHARE_APP_MESSAGE="Page On Share App Message",e.PAGE_ON_SHARE_TIMELINE="Page On Share Timeline",e.PAGE_ON_TAB_ITEM_TAP="Page On Tab Item Tap",e.TAP="UI.Tap",e.TOUCHMOVE="UI.Touchmove"}(u||(u={})),function(e){e.HTTP="http",e.USER="user",e.DEBUG="debug",e.EXCEPTION="exception",e.LIFECYCLE="lifecycle"}(p||(p={})),function(e){e.XHR="xhr",e.FETCH="fetch",e.CONSOLE="console",e.DOM="dom",e.HISTORY="history",e.ERROR="error",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.MITO="mito",e.VUE="Vue",e.MINI_ROUTE="miniRoute"}(l||(l={})),function(e){e.XHR="xhr",e.FETCH="fetch"}(f||(f={})),function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(h||(h={}));var d={isLogAddBreadcrumb:!0,crossOriginThreshold:1e3},g=Object.prototype.toString;function O(e){return function(t){return g.call(t)==="[object "+e+"]"}}var E={isNumber:O("Number"),isString:O("String"),isBoolean:O("Boolean"),isNull:O("Null"),isUndefined:O("Undefined"),isSymbol:O("Symbol"),isFunction:O("Function"),isObject:O("Object"),isArray:O("Array"),isProcess:O("process"),isWindow:O("Window")};function R(e){switch(g.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}function v(e){return E.isObject(e)&&0===Object.keys(e).length}function y(e){return E.isString(e)&&""===e.trim()||null==e}var m=E.isProcess("undefined"!=typeof process?process:0),T=E.isObject("undefined"!=typeof wx?wx:0)&&E.isFunction("undefined"!=typeof App?App:0),N=E.isWindow("undefined"!=typeof window?window:0);var b=N?window:T?wx:m?process:void 0,A=(b.__MITO__=b.__MITO__||{},b.__MITO__);A.replaceFlag=A.replaceFlag||{};var _=A.replaceFlag;function P(e,t){_[e]||(_[e]=t)}function I(e){return!!_[e]}var S="MITO Logger",U=function(){function e(){var e=this;if(this.enabled=!1,this._console={},b.console=console||b.console,console||b.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in b.console&&(e._console[t]=b.console[t])}))}}return e.prototype.disable=function(){this.enabled=!1},e.prototype.bindOptions=function(e){this.enabled=!!e},e.prototype.enable=function(){this.enabled=!0},e.prototype.getEnableStatus=function(){return this.enabled},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).log.apply(e,o([S+"[Log]:"],t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).warn.apply(e,o([S+"[Warn]:"],t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).error.apply(e,o([S+"[Error]:"],t))},e}(),C=A.logger||(A.logger=new U);function x(){return"undefined"==typeof document||null==document.location?"":document.location.href}function k(e,t,n,r){if(void 0===r&&(r=!1),void 0!==e&&(t in e||r)){var o=n(e[t]);"function"==typeof o&&(e[t]=o)}}function w(){return Date.now()}function H(e,t,n){return!!function(e,t){return typeof e===t}(e,n)||(void 0!==e&&C.error(t+"期望传入"+n+"类型，目前是"+typeof e+"类型"),!1)}function D(e,t,n){return!!function(e,t){return g.call(e)===t}(e,n)||(void 0!==e&&C.error(t+"期望传入"+n+"类型，目前是"+g.call(e)+"类型"),!1)}function M(e){d.isLogAddBreadcrumb=!1,e(),d.isLogAddBreadcrumb=!0}function F(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}function L(e){return E.isString(e)?e:E.isUndefined(e)?"undefined":JSON.stringify(e)}function j(e){return Number(e.split(".")[0])}function W(e,t){var n=[];return Object.keys(t).forEach((function(e){n.push(e+"="+t[e])})),e=-1!==e.indexOf("?")?e+"&"+n.join("&"):e+"?"+n.join("&")}function G(){if(!E.isFunction(getCurrentPages))return"";var e=getCurrentPages();if(!e.length)return"App";var t=e.pop();return W(t.route,t.options)}function B(e,n){var r={time:w(),url:x(),name:e.name,level:n,message:e.message};if(void 0===e.stack||!e.stack)return r;for(var o,a,s,c=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,u=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,p=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,l=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,f=/\((\S*)(?::(\d+))(?::(\d+))\)/,h=e.stack.split("\n"),d=[],g=0,O=h.length;g<O;++g){if(a=c.exec(h[g])){var E=a[2]&&0===a[2].indexOf("native");a[2]&&0===a[2].indexOf("eval")&&(o=f.exec(a[2]))&&(a[2]=o[1],a[3]=o[2],a[4]=o[3]),s={url:E?null:a[2],func:a[1]||i.UNKNOWN_FUNCTION,args:E?[a[2]]:[],line:a[3]?+a[3]:null,column:a[4]?+a[4]:null}}else if(a=p.exec(h[g]))s={url:a[2],func:a[1]||i.UNKNOWN_FUNCTION,args:[],line:+a[3],column:a[4]?+a[4]:null};else{if(!(a=u.exec(h[g])))continue;a[3]&&a[3].indexOf(" > eval")>-1&&(o=l.exec(a[3]))?(a[3]=o[1],a[4]=o[2],a[5]=null):0!==g||a[5]||void 0===e.columnNumber||(d[0].column=e.columnNumber+1),s={url:a[3],func:a[1]||i.UNKNOWN_FUNCTION,args:a[2]?a[2].split(","):[],line:a[4]?+a[4]:null,column:a[5]?+a[5]:null}}!s.func&&s.line&&(s.func=i.UNKNOWN_FUNCTION),d.push(s)}return d.length?t(t({},r),{stack:d}):null}var V,X,q=function(){function e(){this.stack=[],this.isFlushing=!1,"Promise"in b&&(this.micro=Promise.resolve())}return e.prototype.addFn=function(e){var t=this;"function"==typeof e&&("Promise"in b?(this.stack.push(e),this.isFlushing||(this.isFlushing=!0,this.micro.then((function(){return t.flushStack()})))):e())},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.flushStack=function(){var e=this.stack.slice(0);this.stack.length=0,this.isFlushing=!1;for(var t=0;t<e.length;t++)e[t]()},e}();!function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}(V||(V={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":case"log":case"assert":return e.Info;case"warn":case"warning":return e.Warning;case e.Low:case e.Normal:case e.High:case e.Critical:case"error":return e.Error;default:return e.Else}}}(V||(V={})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(X||(X={}));var K,$,J=function(){function e(){this.maxBreadcrumbs=10,this.beforePushBreadcrumb=null,this.stack=[]}return e.prototype.push=function(e){var t=this;if("function"!=typeof this.beforePushBreadcrumb)this.immediatePush(e);else{var n=null,r=this.beforePushBreadcrumb;if(M((function(){n=r(t,e)})),!n)return;this.immediatePush(n)}},e.prototype.immediatePush=function(e){e.time=w(),this.stack.length>=this.maxBreadcrumbs&&this.shift(),this.stack.push(e),C.log(this.stack)},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.getCategory=function(e){switch(e){case u.XHR:case u.FETCH:return p.HTTP;case u.CLICK:case u.ROUTE:case u.TAP:case u.TOUCHMOVE:return p.USER;case u.CUSTOMER:case u.CONSOLE:return p.DEBUG;case u.APP_ON_LAUNCH:case u.APP_ON_SHOW:case u.APP_ON_HIDE:case u.PAGE_ON_SHOW:case u.PAGE_ON_HIDE:case u.PAGE_ON_SHARE_APP_MESSAGE:case u.PAGE_ON_SHARE_TIMELINE:case u.PAGE_ON_TAB_ITEM_TAP:return p.LIFECYCLE;case u.UNHANDLEDREJECTION:case u.CODE_ERROR:case u.RESOURCE:case u.VUE:case u.REACT:default:return p.EXCEPTION}},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.maxBreadcrumbs,n=e.beforePushBreadcrumb;H(t,"maxBreadcrumbs","number")&&(this.maxBreadcrumbs=t),H(n,"beforePushBreadcrumb","function")&&(this.beforePushBreadcrumb=n)},e}(),Y=A.breadcrumb||(A.breadcrumb=new J),Q={};function Z(e,t){var n;switch(e.type){case i.FETCH_ERROR:n=e.type+e.request.method+e.response.status+ee(e.request.url)+t;break;case i.JAVASCRIPT_ERROR:case i.VUE_ERROR:case i.REACT_ERROR:n=e.type+e.name+e.message+t;break;case i.LOG_ERROR:n=e.customTag+e.type+e.name+t;break;case i.PROMISE_ERROR:n=function(e,t){var n=ee(e.url);if(e.name===l.UNHANDLEDREJECTION)return e.type+z(e.message)+t;return e.type+e.name+z(e.message)+n}(e,t);break;default:n=e.type+e.message+t}return n=function(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(n),Q[n]>1?null:("number"==typeof Q[n]?Q[n]++:Q[n]=1,n)}function z(e){var t=function(e){return Object.keys(e).sort().reduce((function(n,r){return E.isObject(e[r])?n[r]=t(e[r]):n[r]=e[r],n}),{})};try{if(/\{.*\}/.test(e)){var n=JSON.parse(e);return n=t(n),JSON.stringify(n)}}catch(t){return e}}function ee(e){return e.replace(/[\?#].*$/,"").replace(/\/\d+([\/]*$)/,"{param}$1")}function te(e){return void 0===e.actionType}!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(K||(K={})),function(e){e.PAGE="PAGE",e.EVENT="EVENT",e.VIEW="VIEW",e.DURATION="DURATION",e.DURATION_VIEW="DURATION_VIEW",e.OTHER="OTHER"}($||($={}));var ne=function(){function e(){this.beforeDataReport=null,this.backTrackerId=null,this.configReportXhr=null,this.configReportUrl=null,this.apikey="",this.trackKey="",this.errorDsn="",this.trackDsn="",this.queue=new q}return e.prototype.getRecord=function(){var e=A.record;return e&&E.isArray(e)&&e.length>2?e:[]},e.prototype.getDeviceInfo=function(){return A.deviceInfo||{}},e.prototype.beforePost=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:if(te(e)){if(!(t=Z(e,this.apikey)))return[2,!1];e.errorId=t}return n=this.getTransportData(e),"function"!=typeof this.beforeDataReport?[3,2]:[4,this.beforeDataReport(n)];case 1:if(!(n=r.sent()))return[2,!1];r.label=2;case 2:return[2,n]}}))}))},e.prototype.xhrPost=function(e,t){return n(this,void 0,void 0,(function(){var n,o=this;return r(this,(function(r){return n=function(){var n=new XMLHttpRequest;n.open(K.Post,t),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.withCredentials=!0,"function"==typeof o.configReportXhr&&o.configReportXhr(n),n.send(JSON.stringify(e))},this.queue.addFn(n),[2]}))}))},e.prototype.wxPost=function(e,t){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){return n=function(){wx.request({method:"POST",header:{"Content-Type":"application/json;charset=UTF-8"},url:t,data:e})},this.queue.addFn(n),[2]}))}))},e.prototype.getAuthInfo=function(){var e=this.getTrackerId(),t={trackerId:String(e),sdkVersion:"2.1.3",sdkName:"mitojs"};return this.apikey&&(t.apikey=this.apikey),this.trackKey&&(t.trackKey=this.trackKey),t},e.prototype.getApikey=function(){return this.apikey},e.prototype.getTrackKey=function(){return this.trackKey},e.prototype.getTrackerId=function(){if("function"==typeof this.backTrackerId){var e=this.backTrackerId();if("string"==typeof e||"number"==typeof e)return e;C.error("trackerId:"+e+" 期望 string 或 number 类型，但是传入 "+typeof e)}return""},e.prototype.getTransportData=function(e){return{authInfo:this.getAuthInfo(),breadcrumb:Y.getStack(),data:e,record:this.getRecord(),deviceInfo:this.getDeviceInfo()}},e.prototype.isSdkTransportUrl=function(e){var t=!1;return this.errorDsn&&-1!==e.indexOf(this.errorDsn)&&(t=!0),this.trackDsn&&-1!==e.indexOf(this.trackDsn)&&(t=!0),t},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.dsn,n=e.beforeDataReport,r=e.apikey,o=e.configReportXhr,i=e.backTrackerId,a=e.trackDsn,s=e.trackKey,c=e.configReportUrl;H(r,"apikey","string")&&(this.apikey=r),H(s,"trackKey","string")&&(this.trackKey=s),H(t,"dsn","string")&&(this.errorDsn=t),H(a,"trackDsn","string")&&(this.trackDsn=a),H(n,"beforeDataReport","function")&&(this.beforeDataReport=n),H(o,"configReportXhr","function")&&(this.configReportXhr=o),H(i,"backTrackerId","function")&&(this.backTrackerId=i),H(c,"configReportUrl","function")&&(this.configReportUrl=c)},e.prototype.send=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:if(t="",te(e)){if(y(t=this.errorDsn))return C.error("dsn为空，没有传入监控错误上报的dsn地址，请在init中传入"),[2]}else if(y(t=this.trackDsn))return C.error("trackDsn为空，没有传入埋点上报的dsn地址，请在init中传入"),[2];return[4,this.beforePost(e)];case 1:return(n=r.sent())&&("function"!=typeof this.configReportUrl||(t=this.configReportUrl(n,t)))?N?[2,this.xhrPost(n,t)]:T?[2,this.wxPost(n,t)]:[2]:[2]}}))}))},e}(),re=A.transportData||(A.transportData=new ne);function oe(e){var n=e.message,r=void 0===n?"emptyMsg":n,o=e.tag,a=void 0===o?"":o,s=e.level,c=void 0===s?V.Critical:s,p=e.ex,l=void 0===p?"":p,f={};R(l)&&(f=B(l,c));var h=t({type:i.LOG_ERROR,level:c,message:L(r),name:"MITO.log",customTag:L(a),time:w(),url:T?G():x()},f);Y.push({type:u.CUSTOMER,category:Y.getCategory(u.CUSTOMER),data:r,level:V.fromString(c.toString())}),re.send(h)}function ie(e){var t="",n=e.elapsedTime,r=e.time,o=e.method,a=e.traceId,s=e.type,c=e.status,u=s+"--"+o;return t=(t=0===c?n<=d.crossOriginThreshold?"http请求失败，失败原因：跨域限制或域名不存在":"http请求失败，失败原因：超时":function(e){if(e<400)return X.Ok;if(e>=400&&e<500)switch(e){case 401:return X.Unauthenticated;case 403:return X.PermissionDenied;case 404:return X.NotFound;case 409:return X.AlreadyExists;case 413:return X.FailedPrecondition;case 429:return X.ResourceExhausted;default:return X.InvalidArgument}if(e>=500&&e<600)switch(e){case 501:return X.Unimplemented;case 503:return X.Unavailable;case 504:return X.DeadlineExceeded;default:return X.InternalError}return X.UnknownError}(c))===X.Ok?t:t+" "+ee(e.url),{type:i.FETCH_ERROR,url:x(),time:r,elapsedTime:n,level:V.Low,message:t,name:u,request:{httpType:s,traceId:a,method:o,url:e.url,data:e.reqData||""},response:{status:c,data:e.responseText}}}var ae=function(){function e(){this.beforeAppAjaxSend=function(){},this.traceIdFieldName="Trace-Id",this.appOnLaunch=function(){},this.appOnShow=function(){},this.onPageNotFound=function(){},this.appOnHide=function(){},this.pageOnShow=function(){},this.pageOnHide=function(){},this.onShareAppMessage=function(){},this.onShareTimeline=function(){},this.onTabItemTap=function(){},this.triggerWxEvent=function(){},this.enableTraceId=!1}return e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.beforeAppAjaxSend,n=e.enableTraceId,r=e.filterXhrUrlRegExp,o=e.traceIdFieldName,i=e.includeHttpUrlTraceIdRegExp,a=e.appOnLaunch,s=e.appOnShow,c=e.appOnHide,u=e.pageOnShow,p=e.pageOnHide,l=e.onPageNotFound,f=e.onShareAppMessage,h=e.onShareTimeline,d=e.onTabItemTap,g=e.wxNavigateToMiniProgram,O=e.triggerWxEvent;H(t,"beforeAppAjaxSend","function")&&(this.beforeAppAjaxSend=t),H(a,"appOnLaunch","function")&&(this.appOnLaunch=a),H(s,"appOnShow","function")&&(this.appOnShow=s),H(c,"appOnHide","function")&&(this.appOnHide=c),H(u,"pageOnShow","function")&&(this.pageOnShow=u),H(p,"pageOnHide","function")&&(this.pageOnHide=p),H(l,"onPageNotFound","function")&&(this.onPageNotFound=l),H(f,"onShareAppMessage","function")&&(this.onShareAppMessage=f),H(h,"onShareTimeline","function")&&(this.onShareTimeline=h),H(d,"onTabItemTap","function")&&(this.onTabItemTap=d),H(g,"wxNavigateToMiniProgram","function")&&(this.wxNavigateToMiniProgram=g),H(O,"triggerWxEvent","function")&&(this.triggerWxEvent=O),H(n,"enableTraceId","boolean")&&(this.enableTraceId=n),H(o,"traceIdFieldName","string")&&(this.traceIdFieldName=o),D(r,"filterXhrUrlRegExp","[object RegExp]")&&(this.filterXhrUrlRegExp=r),D(i,"includeHttpUrlTraceIdRegExp","[object RegExp]")&&(this.includeHttpUrlTraceIdRegExp=i)},e}(),se=A.options||(A.options=new ae);function ce(e,t){var n=se.includeHttpUrlTraceIdRegExp;if(se.enableTraceId&&n&&n.test(e)){var r=F();t(se.traceIdFieldName,r)}}function ue(e){void 0===e&&(e={}),function(e){void 0===e&&(e={}),P(l.XHR,!!e.silentXhr),P(l.FETCH,!!e.silentFetch),P(l.CONSOLE,!!e.silentConsole),P(l.DOM,!!e.silentDom),P(l.HISTORY,!!e.silentHistory),P(l.ERROR,!!e.silentError),P(l.HASHCHANGE,!!e.silentHashchange),P(l.UNHANDLEDREJECTION,!!e.silentUnhandledrejection),P(l.VUE,!!e.silentVue),P(a.AppOnError,!!e.silentWxOnError),P(a.AppOnUnhandledRejection,!!e.silentUnhandledrejection),P(a.AppOnPageNotFound,!!e.silentWxOnPageNotFound),P(s.PageOnShareAppMessage,!!e.silentWxOnShareAppMessage),P(l.MINI_ROUTE,!!e.silentMiniRoute)}(e),Y.bindOptions(e),C.bindOptions(e.debug),re.bindOptions(e),se.bindOptions(e)}var pe,le={};function fe(e,t){e&&le[e]&&le[e].forEach((function(n){!function(e,t){try{e()}catch(e){console.log("err",e),t&&t(e)}}((function(){n(t)}),(function(t){var r;C.error("重写事件triggerHandlers的回调函数发生错误\nType:"+e+"\nName: "+(((r=n)&&"function"==typeof r&&r.name||"<anonymous>")+"\nError: ")+t)}))}))}function he(e){var t,n;return"<element "+((null===(t=e.currentTarget)||void 0===t?void 0:t.id)?' id="'+(null===(n=e.currentTarget)||void 0===n?void 0:n.id)+'"':"")+" "+Object.keys(e.currentTarget.dataset).map((function(t){return"data-"+t+"="+e.currentTarget.dataset[t]})).join(" ")+"/>"}function de(){return n(this,void 0,void 0,(function(){var e,t,n,o,i;return r(this,(function(r){switch(r.label){case 0:return e=wx.getSystemInfoSync(),t=e.pixelRatio,n=e.screenHeight,o=e.screenWidth,[4,ge()];case 1:return i=r.sent(),[2,{ratio:t,clientHeight:n,clientWidth:o,netType:i}]}}))}))}function ge(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,new Promise((function(e,t){wx.getNetworkType({success:function(t){e(t.networkType)},fail:function(t){console.error("获取微信小程序网络类型失败:"+t),e("getNetWrokType failed")}})}))]}))}))}!function(e){e.Touchmove="touchmove",e.Tap="tap",e.Longtap="longtap",e.Longpress="longpress"}(pe||(pe={}));var Oe={onLaunch:function(e){se.appOnLaunch(e);var t={path:e.path,query:e.query};Y.push({category:Y.getCategory(u.APP_ON_LAUNCH),type:u.APP_ON_LAUNCH,data:t,level:V.Info})},onShow:function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return t=A,[4,de()];case 1:return t.deviceInfo=r.sent(),se.appOnShow(e),n={path:e.path,query:e.query},Y.push({category:Y.getCategory(u.APP_ON_SHOW),type:u.APP_ON_SHOW,data:n,level:V.Info}),[2]}}))}))},onHide:function(){se.appOnHide(),Y.push({category:Y.getCategory(u.APP_ON_HIDE),type:u.APP_ON_HIDE,data:null,level:V.Info})},onError:function(e){var n=function(e){var t=e.split("\n");if(t.length<2)return null;-1!==t[0].indexOf("MiniProgramError")&&t.splice(0,1);var n=t.splice(0,1)[0],r=t.splice(0,1)[0].split(":")[0],o=[];return t.forEach((function(e){var t=/at\s+([\S]+)\s+\(/.exec(e),n=/\(([^)]+)\)/.exec(e);n||(n=/\s+at\s+(\S+)/.exec(e));var r=Array.isArray(t)&&t.length>0?t[1].trim():"",a=(Array.isArray(n)&&n.length>0?n[1]:"").split(":");o.push({args:[],func:r||i.UNKNOWN_FUNCTION,column:Number(a.pop()),line:Number(a.pop()),url:a.join(":")})})),{message:n,name:r,stack:o}}(e),r=t(t({},n),{time:w(),level:V.Normal,url:G(),type:i.JAVASCRIPT_ERROR});Y.push({category:Y.getCategory(u.CODE_ERROR),type:u.CODE_ERROR,level:V.Error,data:t({},r)}),re.send(r)},onUnhandledRejection:function(e){var n={type:i.PROMISE_ERROR,message:L(e.reason),url:G(),name:"unhandledrejection",time:w(),level:V.Low};R(e.reason)&&(n=t(t(t({},n),B(e.reason,V.Low)),{url:G()})),Y.push({type:u.UNHANDLEDREJECTION,category:Y.getCategory(u.UNHANDLEDREJECTION),data:t({},n),level:V.Error}),re.send(n)},onPageNotFound:function(e){se.onPageNotFound(e),Y.push({category:Y.getCategory(u.ROUTE),type:u.ROUTE,data:e,level:V.Error})}},Ee={onShow:function(){var e=getCurrentPages().pop();se.pageOnShow(e);var t={path:e.route,query:e.options};Y.push({category:Y.getCategory(u.PAGE_ON_SHOW),type:u.PAGE_ON_SHOW,data:t,level:V.Info})},onHide:function(){var e=getCurrentPages().pop();se.pageOnHide(e);var t={path:e.route,query:e.options};Y.push({category:Y.getCategory(u.PAGE_ON_HIDE),type:u.PAGE_ON_HIDE,data:t,level:V.Info})},onShareAppMessage:function(e){var n=getCurrentPages().pop();se.onShareAppMessage(t(t({},n),e));var r={path:n.route,query:n.options,options:e};Y.push({category:Y.getCategory(u.PAGE_ON_SHARE_APP_MESSAGE),type:u.PAGE_ON_SHARE_APP_MESSAGE,data:r,level:V.Info})},onShareTimeline:function(){var e=getCurrentPages().pop();se.onShareTimeline(e);var t={path:e.route,query:e.options};Y.push({category:Y.getCategory(u.PAGE_ON_SHARE_TIMELINE),type:u.PAGE_ON_SHARE_TIMELINE,data:t,level:V.Info})},onTabItemTap:function(e){var n=getCurrentPages().pop();se.onTabItemTap(t(t({},n),e));var r={path:n.route,query:n.options,options:e};Y.push({category:Y.getCategory(u.PAGE_ON_TAB_ITEM_TAP),type:u.PAGE_ON_TAB_ITEM_TAP,data:r,level:V.Info})},onAction:function(e){se.triggerWxEvent(e);var t=u.TOUCHMOVE;e.type===pe.Tap&&(t=u.TAP),Y.push({category:Y.getCategory(t),type:t,data:he(e),level:V.Info})}},Re=function(e){!function(e){d.isLogAddBreadcrumb&&Y.push({type:u.CONSOLE,category:Y.getCategory(u.CONSOLE),data:e,level:V.fromString(e.level)})}(e)},ve=function(e){var n=ie(e);n.url=G(),void 0===e.status&&(n.message=e.errMsg);var r,o=u.XHR;Y.push({type:o,category:Y.getCategory(o),data:n,level:V.Info}),(0===(r=e.status)||r===h.BAD_REQUEST||r>h.UNAUTHORIZED)&&(Y.push({type:o,category:Y.getCategory(u.CODE_ERROR),data:t({},n),level:V.Error}),re.send(n))},ye=function(e){if(e.isFail){Y.push({type:u.ROUTE,category:Y.getCategory(u.CODE_ERROR),data:e,level:V.Error});var t={type:i.ROUTE_ERROR,message:e.message,url:e.to,name:"MINI_"+i.ROUTE_ERROR,level:V.Error};return re.send(t)}Y.push({type:u.ROUTE,category:Y.getCategory(u.ROUTE),data:e,level:V.Info})};function me(e){return se.filterXhrUrlRegExp&&se.filterXhrUrlRegExp.test(e)}function Te(e){switch(e){case l.CONSOLE:!function(){if(console&&E.isObject(console)){["log","debug","info","warn","error","assert"].forEach((function(e){e in console&&k(console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&(fe(l.CONSOLE,{args:n,level:e}),t.apply(console,n))}}))}))}}();break;case l.XHR:["request","downloadFile","uploadFile"].forEach((function(e){var n=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var i,a=r[0];i=a.method?a.method:"downloadFile"===e?K.Get:K.Post;var s,c=a.url,u=a.header;if(!u||(u={}),i===K.Post&&re.isSdkTransportUrl(c)||me(c))return n.call(this,a);s="request"===e?a.data:"downloadFile"===e?{filePath:a.filePath}:{filePath:a.filePath,name:a.name};var p={type:f.XHR,method:i,url:c,reqData:s,sTime:w()};function h(e,t){u[e]=t}ce(c,(function(e,t){p.traceId=t,u[e]=t})),se.beforeAppAjaxSend&&se.beforeAppAjaxSend({method:i,url:c},{setRequestHeader:h});var d=function(e){var t=w();if(p.responseText=(E.isString(e.data)||E.isObject(e.data))&&e.data,p.elapsedTime=t-p.sTime,p.status=e.statusCode,p.errMsg=e.errMsg,p.time=t,fe(l.XHR,p),"function"==typeof a.success)return a.success(e)},g=a.fail,O=function(e){var t=w();if(p.elapsedTime=t-p.sTime,p.errMsg=e.errMsg,fe(l.XHR,p),E.isFunction(g))return g(e)},R=t(t({},a),{success:d,fail:O});return n.call(this,R)}})}));break;case l.MINI_ROUTE:[c.SwitchTab,c.ReLaunch,c.RedirectTo,c.NavigateTo,c.NavigateBack,c.NavigateToMiniProgram].forEach((function(e){var n=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(r){var o,i;i=e===c.NavigateBack?function(e){if(!E.isFunction(getCurrentPages))return"";var t=getCurrentPages();if(!t.length)return"App";e=e||1;var n=t[t.length-e];return W(n.route,n.options)}(null===(o=r)||void 0===o?void 0:o.delta):r.url;var a={from:G(),to:i};if(fe(l.MINI_ROUTE,a),E.isFunction(r.complete)||E.isFunction(r.success)||E.isFunction(r.fail)){var s=r.fail;r.fail=function(e){var n=t(t({},a),{isFail:!0,message:e.errMsg});if(fe(l.MINI_ROUTE,n),E.isFunction(s))return s(e)}}return e===c.NavigateToMiniProgram&&E.isFunction(se.wxNavigateToMiniProgram)&&(r=se.wxNavigateToMiniProgram(r)),n.call(this,r)}})}))}}function Ne(e){(function(e){return!(!e||I(e.type))&&(P(e.type,!0),le[e.type]=le[e.type]||[],le[e.type].push(e.callback),!0)})(e)&&Te(e.type)}var be=[s.PageOnShow,s.PageOnHide,s.PageOnShareAppMessage,s.PageOnShareTimeline,s.PageOnTabItemTap];function Ae(e){be.forEach((function(t){k(e,t.replace("PageOn","on"),(function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(fe.apply(null,o([t],n)),e)return e.apply(this,n)}}),!0)}))}function _e(e){var t,n,r,o=(t=function(e){e.mitoWorked=!0,fe(l.DOM,e)},n=500,r=!0,function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r&&(t.apply(this,e),r=!1,setTimeout((function(){r=!0}),n))}),i=[pe.Touchmove,pe.Tap];e&&Object.keys(e).forEach((function(t){"function"==typeof e[t]&&k(e,t,(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0];return r&&r.type&&r.currentTarget&&!r.mitoWorked&&i.indexOf(r.type)>-1&&o(r),e.apply(this,t)}}),!0)}))}function Pe(){!function(){if(App){var e=App;App=function(t){return[a.AppOnLaunch,a.AppOnShow,a.AppOnError,a.AppOnUnhandledRejection,a.AppOnPageNotFound,a.AppOnHide].forEach((function(e){I(e)||(Ne({callback:function(t){return Oe[e.replace("AppOn","on")](t)},type:e}),k(t,e.replace("AppOn","on"),(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&t.apply(this,n),fe.apply(null,o([e],n))}}),!0))})),e(t)}}}(),function(){if(Page){var e=Page;be.forEach((function(e){I(e)||Ne({callback:function(t){return Ee[e.replace("PageOn","on")](t)},type:e})})),Page=function(t){return Ae(t),_e(t),e.call(this,t)}}}(),function(){if(Component){var e=Component;Component=function(t){return v(t.methods)||(Ae(t.methods),_e(t.methods)),e.call(this,t)}}}(),function(){if(Behavior){var e=Behavior;Behavior=function(t){return v(t.methods)||_e(t.methods),e.call(this,t)}}}(),Ne({callback:function(e){return ye(e)},type:l.MINI_ROUTE}),Ne({callback:function(e){ve(e)},type:l.XHR}),Ne({callback:function(e){Re(e)},type:l.CONSOLE}),Ne({callback:function(e){return Ee.onAction(e)},type:l.DOM})}function Ie(e){var n=F(),r=w();re.send(t({id:n,trackTime:r},e))}function Se(e,n,r,o,a,s){var c=null==s?void 0:s.version,p={type:i.VUE_ERROR,message:e.message+"("+r+")",level:o,url:x(),name:e.name,stack:e.stack||[],time:w()};if(E.isString(c))switch(console.log("getBigVersion",j(c)),j(c)){case 2:p=t(t({},p),function(e){var t="";if(e.$root===e)t="root";else{var n=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name;t=(n?"component <"+n+">":"anonymous component")+(e._isVue&&e.$options&&e.$options.__file?" at "+(e.$options&&e.$options.__file):"")}return{componentName:t,propsData:e.$options&&e.$options.propsData}}(n));break;case 3:p=t(t({},p),function(e){var t="";if(e.$root===e)t="root";else{console.log(e.$options);var n=e.$options&&e.$options.name;t=n?"component <"+n+">":"anonymous component"}return{componentName:t,propsData:e.$props}}(n));break;default:return}Y.push({type:u.VUE,category:Y.getCategory(u.VUE),data:p,level:a}),re.send(p)}var Ue="undefined"!=typeof console,Ce={install:function(e){!I(l.VUE)&&e&&e.config&&(P(l.VUE,!0),e.config.errorHandler=function(t,n,r){Se.apply(null,[t,n,r,V.Normal,V.Error,e]),Ue&&!e.config.silent&&M((function(){console.error("Error in "+r+': "'+t.toString()+'"',n),console.error(t)}))})}};return e.MitoVue=Ce,e.errorBoundaryReport=function(e){if(R(e)){var t=B(e,V.Normal);t.type=i.REACT_ERROR,Y.push({type:u.REACT,category:Y.getCategory(u.REACT),data:t.name+": "+t.message,level:V.fromString(t.level)}),re.send(t)}else console.warn("传入的react error不是一个object Error")},e.init=function(e){void 0===e&&(e={}),T&&(ue(e),Pe(),Object.assign(wx,{mitoLog:oe,SDK_NAME:"mitojs",SDK_VERSION:"2.1.3"}))},e.log=oe,e.sendTrackData=Ie,e.track=function(e,n){var r=t(t({},n),{actionType:e});return Ie(r),r},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
