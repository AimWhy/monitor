var MITO=function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))}function r(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function o(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,c=a.length;i<c;i++,o++)r[o]=a[i];return r}var a,i,c,s,u,l,p,f,h;!function(e){e.UNKNOWN="UNKNOWN",e.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",e.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",e.LOG_ERROR="LOG_ERROR",e.FETCH_ERROR="HTTP_ERROR",e.VUE_ERROR="VUE_ERROR",e.REACT_ERROR="REACT_ERROR",e.RESOURCE_ERROR="RESOURCE_ERROR",e.PROMISE_ERROR="PROMISE_ERROR",e.ROUTE_ERROR="ROUTE_ERROR"}(a||(a={})),function(e){e.AppOnLaunch="AppOnLaunch",e.AppOnShow="AppOnShow",e.AppOnHide="AppOnHide",e.AppOnError="AppOnError",e.AppOnPageNotFound="AppOnPageNotFound",e.AppOnUnhandledRejection="AppOnUnhandledRejection"}(i||(i={})),function(e){e.PageOnShow="PageOnShow",e.PageOnHide="PageOnHide",e.PageOnShareAppMessage="PageOnShareAppMessage",e.PageOnShareTimeline="PageOnShareTimeline",e.PageOnTabItemTap="PageOnTabItemTap"}(c||(c={})),function(e){e.SwitchTab="switchTab",e.ReLaunch="reLaunch",e.RedirectTo="redirectTo",e.NavigateTo="navigateTo",e.NavigateBack="navigateBack",e.RouteFail="routeFail"}(s||(s={})),t(t(t({},i),c),a),function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.XHR="Xhr",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.VUE="Vue",e.REACT="React",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer",e.APP_ON_SHOW="App On Show",e.APP_ON_LAUNCH="App On Launch",e.APP_ON_HIDE="App On Hide",e.PAGE_ON_SHOW="Page On Show",e.PAGE_ON_HIDE="Page On Hide",e.PAGE_ON_SHARE_APP_MESSAGE="Page On Share App Message",e.PAGE_ON_SHARE_TIMELINE="Page On Share Timeline",e.PAGE_ON_TAB_ITEM_TAP="Page On Tab Item Tap",e.TAP="UI.Tap",e.TOUCHMOVE="UI.Touchmove"}(u||(u={})),function(e){e.HTTP="http",e.USER="user",e.DEBUG="debug",e.EXCEPTION="exception",e.LIFECYCLE="lifecycle"}(l||(l={})),function(e){e.XHR="xhr",e.FETCH="fetch",e.CONSOLE="console",e.DOM="dom",e.HISTORY="history",e.ERROR="error",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.MITO="mito",e.VUE="Vue",e.MINI_ROUTE="miniRoute"}(p||(p={})),function(e){e.XHR="xhr",e.FETCH="fetch"}(f||(f={})),function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(h||(h={}));var d={isLogAddBreadcrumb:!0,crossOriginThreshold:1e3},g=Object.prototype.toString;function O(e){return function(t){return g.call(t)==="[object "+e+"]"}}var E={isNumber:O("Number"),isString:O("String"),isBoolean:O("Boolean"),isNull:O("Null"),isUndefined:O("Undefined"),isSymbol:O("Symbol"),isFunction:O("Function"),isObject:O("Object"),isArray:O("Array"),isProcess:O("process"),isWindow:O("Window")};function R(e){switch(g.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}function y(e){return E.isObject(e)&&0===Object.keys(e).length}function v(e){return E.isString(e)&&""===e.trim()||null==e}var T=E.isProcess("undefined"!=typeof process?process:0),m=E.isObject("undefined"!=typeof wx?wx:0)&&E.isFunction("undefined"!=typeof App?App:0),b=E.isWindow("undefined"!=typeof window?window:0);var A=b?window:m?wx:T?process:void 0,N=(A.__MITO__=A.__MITO__||{},A.__MITO__);N.replaceFlag=N.replaceFlag||{};var _=N.replaceFlag;function P(e,t){_[e]||(_[e]=t)}function I(e){return!!_[e]}var S="MITO Logger",C=function(){function e(){var e=this;if(this.enabled=!1,this._console={},A.console=console||A.console,console||A.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in A.console&&(e._console[t]=A.console[t])}))}}return e.prototype.disable=function(){this.enabled=!1},e.prototype.bindOptions=function(e){this.enabled=!!e},e.prototype.enable=function(){this.enabled=!0},e.prototype.getEnableStatus=function(){return this.enabled},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).log.apply(e,o([S+"[Log]:"],t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).warn.apply(e,o([S+"[Warn]:"],t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).error.apply(e,o([S+"[Error]:"],t))},e}(),U=N.logger||(N.logger=new C);function x(){return"undefined"==typeof document||null==document.location?"":document.location.href}function H(e,t,n,r){if(void 0===r&&(r=!1),t in e||r){var o=n(e[t]);"function"==typeof o&&(e[t]=o)}}function k(){return Date.now()}function w(e,t,n){return!!function(e,t){return typeof e===t}(e,n)||(void 0!==e&&U.error(t+"期望传入"+n+"类型，目前是"+typeof e+"类型"),!1)}function D(e,t,n){return!!function(e,t){return g.call(e)===t}(e,n)||(void 0!==e&&U.error(t+"期望传入"+n+"类型，目前是"+g.call(e)+"类型"),!1)}function F(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}function M(e){return E.isString(e)?e:E.isUndefined(e)?"undefined":JSON.stringify(e)}function L(e,t){var n=[];return Object.keys(t).forEach((function(e){n.push(e+"="+t[e])})),e=-1!==e.indexOf("?")?e+"&"+n.join("&"):e+"?"+n.join("&")}function j(){if(!E.isFunction(getCurrentPages))return"";var e=getCurrentPages();if(!e.length)return"App";var t=e.pop();return L(t.route,t.options)}function G(e,n){var r={time:k(),url:x(),name:e.name,level:n,message:e.message};if(void 0===e.stack||!e.stack)return r;for(var o,i,c,s=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,u=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,l=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,p=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,f=/\((\S*)(?::(\d+))(?::(\d+))\)/,h=e.stack.split("\n"),d=[],g=0,O=h.length;g<O;++g){if(i=s.exec(h[g])){var E=i[2]&&0===i[2].indexOf("native");i[2]&&0===i[2].indexOf("eval")&&(o=f.exec(i[2]))&&(i[2]=o[1],i[3]=o[2],i[4]=o[3]),c={url:E?null:i[2],func:i[1]||a.UNKNOWN_FUNCTION,args:E?[i[2]]:[],line:i[3]?+i[3]:null,column:i[4]?+i[4]:null}}else if(i=l.exec(h[g]))c={url:i[2],func:i[1]||a.UNKNOWN_FUNCTION,args:[],line:+i[3],column:i[4]?+i[4]:null};else{if(!(i=u.exec(h[g])))continue;i[3]&&i[3].indexOf(" > eval")>-1&&(o=p.exec(i[3]))?(i[3]=o[1],i[4]=o[2],i[5]=null):0!==g||i[5]||void 0===e.columnNumber||(d[0].column=e.columnNumber+1),c={url:i[3],func:i[1]||a.UNKNOWN_FUNCTION,args:i[2]?i[2].split(","):[],line:i[4]?+i[4]:null,column:i[5]?+i[5]:null}}!c.func&&c.line&&(c.func=a.UNKNOWN_FUNCTION),d.push(c)}return d.length?t(t({},r),{stack:d}):null}var B,W,X=function(){function e(){this.stack=[],this.isFlushing=!1,"Promise"in A&&(this.micro=Promise.resolve())}return e.prototype.addFn=function(e){var t=this;"function"==typeof e&&("Promise"in A?(this.stack.push(e),this.isFlushing||(this.isFlushing=!0,this.micro.then((function(){return t.flushStack()})))):e())},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.flushStack=function(){var e=this.stack.slice(0);this.stack.length=0,this.isFlushing=!1;for(var t=0;t<e.length;t++)e[t]()},e}();!function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}(B||(B={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":case"log":case"assert":return e.Info;case"warn":case"warning":return e.Warning;case e.Low:case e.Normal:case e.High:case e.Critical:case"error":return e.Error;default:return e.Else}}}(B||(B={})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(W||(W={}));var q,V,J=function(){function e(){this.maxBreadcrumbs=10,this.beforePushBreadcrumb=null,this.stack=[]}return e.prototype.push=function(e){var t=this;if("function"!=typeof this.beforePushBreadcrumb){var n;this.immediatePush(e)}else{var r=null,o=this.beforePushBreadcrumb;if(n=function(){r=o(t,e)},d.isLogAddBreadcrumb=!1,n(),d.isLogAddBreadcrumb=!0,!r)return;this.immediatePush(r)}},e.prototype.immediatePush=function(e){e.time=k(),this.stack.length>=this.maxBreadcrumbs&&this.shift(),this.stack.push(e),U.log(this.stack)},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.getCategory=function(e){switch(e){case u.XHR:case u.FETCH:return l.HTTP;case u.CLICK:case u.ROUTE:case u.TAP:case u.TOUCHMOVE:return l.USER;case u.CUSTOMER:case u.CONSOLE:return l.DEBUG;case u.APP_ON_LAUNCH:case u.APP_ON_SHOW:case u.APP_ON_HIDE:case u.PAGE_ON_SHOW:case u.PAGE_ON_HIDE:case u.PAGE_ON_SHARE_APP_MESSAGE:case u.PAGE_ON_SHARE_TIMELINE:case u.PAGE_ON_TAB_ITEM_TAP:return l.LIFECYCLE;case u.UNHANDLEDREJECTION:case u.CODE_ERROR:case u.RESOURCE:case u.VUE:case u.REACT:default:return l.EXCEPTION}},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.maxBreadcrumbs,n=e.beforePushBreadcrumb;w(t,"maxBreadcrumbs","number")&&(this.maxBreadcrumbs=t),w(n,"beforePushBreadcrumb","function")&&(this.beforePushBreadcrumb=n)},e}(),K=N.breadcrumb||(N.breadcrumb=new J),$={};function Y(e,t){var n;switch(e.type){case a.FETCH_ERROR:n=e.type+e.request.method+e.response.status+Z(e.request.url)+t;break;case a.JAVASCRIPT_ERROR:case a.VUE_ERROR:case a.REACT_ERROR:n=e.type+e.name+e.message+t;break;case a.LOG_ERROR:n=e.customTag+e.type+e.name+t;break;case a.PROMISE_ERROR:n=function(e,t){var n=Z(e.url);if(e.name===p.UNHANDLEDREJECTION)return e.type+Q(e.message)+t;return e.type+e.name+Q(e.message)+n}(e,t);break;default:n=e.type+e.message+t}return n=function(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(n),$[n]>1?null:("number"==typeof $[n]?$[n]++:$[n]=1,n)}function Q(e){var t=function(e){return Object.keys(e).sort().reduce((function(n,r){return E.isObject(e[r])?n[r]=t(e[r]):n[r]=e[r],n}),{})};try{if(/\{.*\}/.test(e)){var n=JSON.parse(e);return n=t(n),JSON.stringify(n)}}catch(t){return e}}function Z(e){return e.replace(/[\?#].*$/,"").replace(/\/\d+([\/]*$)/,"{param}$1")}function z(e){return void 0===e.actionType}!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(q||(q={})),function(e){e.PAGE="PAGE",e.EVENT="EVENT",e.VIEW="VIEW",e.DURATION="DURATION",e.OTHER="OTHER"}(V||(V={}));var ee=function(){function e(){this.beforeDataReport=null,this.backTrackerId=null,this.configReportXhr=null,this.apikey="",this.errorDsn="",this.trackDsn="",this.queue=new X}return e.prototype.getRecord=function(){var e=N.record;return e&&E.isArray(e)&&e.length>2?e:[]},e.prototype.getDeviceInfo=function(){return N.deviceInfo||{}},e.prototype.beforePost=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:if(z(e)){if(!(t=Y(e,this.apikey)))return[2,!1];e.errorId=t}return n=this.getTransportData(e),"function"!=typeof this.beforeDataReport?[3,2]:[4,this.beforeDataReport(n)];case 1:if(!(n=r.sent()))return[2,!1];r.label=2;case 2:return[2,JSON.stringify(n)]}}))}))},e.prototype.xhrPost=function(e,t){return n(this,void 0,void 0,(function(){var n,o,a=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.beforePost(e)];case 1:return(n=r.sent())?(o=function(){var e=new XMLHttpRequest;e.open(q.Post,t),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.withCredentials=!0,"function"==typeof a.configReportXhr&&a.configReportXhr(e),e.send(n)},this.queue.addFn(o),[2]):[2]}}))}))},e.prototype.wxPost=function(e,t){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return[4,this.beforePost(e)];case 1:return(n=r.sent())?(o=function(){wx.request({method:"POST",header:{"Content-Type":"application/json;charset=UTF-8"},url:t,data:n})},this.queue.addFn(o),[2]):[2]}}))}))},e.prototype.getAuthInfo=function(){var e=this.getTrackerId();return{trackerId:String(e),sdkVersion:"2.0.3",sdkName:"mitojs",apikey:this.apikey}},e.prototype.getApikey=function(){return this.apikey},e.prototype.getTrackerId=function(){if("function"==typeof this.backTrackerId){var e=this.backTrackerId();if("string"==typeof e||"number"==typeof e)return e;U.error("trackerId:"+e+" 期望 string 或 number 类型，但是传入 "+typeof e)}return""},e.prototype.getTransportData=function(e){return{authInfo:this.getAuthInfo(),breadcrumb:K.getStack(),data:e,record:this.getRecord(),deviceInfo:this.getDeviceInfo()}},e.prototype.isSdkTransportUrl=function(e){return-1!==e.indexOf(this.errorDsn)},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.dsn,n=e.beforeDataReport,r=e.apikey,o=e.configReportXhr,a=e.backTrackerId,i=e.trackDsn;w(r,"apikey","string")&&(this.apikey=r),w(t,"dsn","string")&&(this.errorDsn=t),w(i,"trackDsn","string")&&(this.trackDsn=i),w(n,"beforeDataReport","function")&&(this.beforeDataReport=n),w(o,"configReportXhr","function")&&(this.configReportXhr=o),w(a,"backTrackerId","function")&&(this.backTrackerId=a)},e.prototype.send=function(e){var t="";if(z(e)){if(v(t=this.errorDsn))return void U.error("dsn为空，没有传入监控错误上报的dsn地址，请在init中传入")}else if(v(t=this.trackDsn))return void U.error("trackDsn为空，没有传入埋点上报的dsn地址，请在init中传入");return b?this.xhrPost(e,t):m?this.wxPost(e,t):void 0},e}(),te=N.transportData||(N.transportData=new ee);function ne(e){var n=e.message,r=void 0===n?"emptyMsg":n,o=e.tag,i=void 0===o?"":o,c=e.level,s=void 0===c?B.Critical:c,l=e.ex,p=void 0===l?"":l,f={};R(p)&&(f=G(p,s));var h=t({type:a.LOG_ERROR,level:s,message:M(r),name:"MITO.log",customTag:M(i),time:k(),url:m?j():x()},f);K.push({type:u.CUSTOMER,category:K.getCategory(u.CUSTOMER),data:r,level:B.fromString(s.toString())}),te.send(h)}function re(e){var t="",n=e.elapsedTime,r=e.time,o=e.method,i=e.traceId,c=e.type,s=e.status,u=c+"--"+o;return t=(t=0===s?n<=d.crossOriginThreshold?"http请求失败，失败原因：跨域限制或域名不存在":"http请求失败，失败原因：超时":function(e){if(e<400)return W.Ok;if(e>=400&&e<500)switch(e){case 401:return W.Unauthenticated;case 403:return W.PermissionDenied;case 404:return W.NotFound;case 409:return W.AlreadyExists;case 413:return W.FailedPrecondition;case 429:return W.ResourceExhausted;default:return W.InvalidArgument}if(e>=500&&e<600)switch(e){case 501:return W.Unimplemented;case 503:return W.Unavailable;case 504:return W.DeadlineExceeded;default:return W.InternalError}return W.UnknownError}(s))===W.Ok?t:t+" "+Z(e.url),{type:a.FETCH_ERROR,url:x(),time:r,elapsedTime:n,level:B.Low,message:t,name:u,request:{httpType:c,traceId:i,method:o,url:e.url,data:e.reqData||""},response:{status:s,data:e.responseText}}}var oe=function(){function e(){this.beforeAppAjaxSend=function(){},this.traceIdFieldName="Trace-Id",this.appOnLauch=function(){},this.appOnShow=function(){},this.onPageNotFound=function(){},this.appOnHide=function(){},this.pageOnShow=function(){},this.pageOnHide=function(){},this.onShareAppMessage=function(){},this.onShareTimeline=function(){},this.onTabItemTap=function(){},this.enableTraceId=!1}return e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.beforeAppAjaxSend,n=e.enableTraceId,r=e.filterXhrUrlRegExp,o=e.traceIdFieldName,a=e.includeHttpUrlTraceIdRegExp,i=e.appOnLauch,c=e.appOnShow,s=e.appOnHide,u=e.pageOnShow,l=e.pageOnHide,p=e.onPageNotFound,f=e.onShareAppMessage,h=e.onShareTimeline,d=e.onTabItemTap;w(t,"beforeAppAjaxSend","function")&&(this.beforeAppAjaxSend=t),w(i,"appOnLauch","function")&&(this.appOnLauch=i),w(c,"appOnShow","function")&&(this.appOnShow=c),w(s,"appOnHide","function")&&(this.appOnHide=s),w(u,"pageOnShow","function")&&(this.pageOnShow=u),w(l,"pageOnHide","function")&&(this.pageOnHide=l),w(p,"onPageNotFound","function")&&(this.onPageNotFound=p),w(f,"onShareAppMessage","function")&&(this.onShareAppMessage=f),w(h,"onShareTimeline","function")&&(this.onShareTimeline=h),w(d,"onTabItemTap","function")&&(this.onTabItemTap=d),w(n,"enableTraceId","boolean")&&(this.enableTraceId=n),w(o,"traceIdFieldName","string")&&(this.traceIdFieldName=o),D(r,"filterXhrUrlRegExp","[object RegExp]")&&(this.filterXhrUrlRegExp=r),D(a,"includeHttpUrlTraceIdRegExp","[object RegExp]")&&(this.includeHttpUrlTraceIdRegExp=a)},e}(),ae=N.options||(N.options=new oe);function ie(e,t){var n=ae.includeHttpUrlTraceIdRegExp;if(ae.enableTraceId&&n&&n.test(e)){var r=F();t(ae.traceIdFieldName,r)}}function ce(e){void 0===e&&(e={}),function(e){void 0===e&&(e={}),P(p.XHR,!!e.silentXhr),P(p.FETCH,!!e.silentFetch),P(p.CONSOLE,!!e.silentConsole),P(p.DOM,!!e.silentDom),P(p.HISTORY,!!e.silentHistory),P(p.ERROR,!!e.silentError),P(p.HASHCHANGE,!!e.silentHashchange),P(p.UNHANDLEDREJECTION,!!e.silentUnhandledrejection),P(p.VUE,!!e.silentVue),P(i.AppOnError,!!e.silentWxOnError),P(i.AppOnUnhandledRejection,!!e.silentUnhandledrejection),P(i.AppOnPageNotFound,!!e.silentWxOnPageNotFound),P(c.PageOnShareAppMessage,!!e.silentWxOnShareAppMessage),P(p.MINI_ROUTE,!!e.silentMiniRoute)}(e),K.bindOptions(e),U.bindOptions(e.debug),te.bindOptions(e),ae.bindOptions(e)}var se,ue={};function le(e,t){e&&ue[e]&&ue[e].forEach((function(n){!function(e,t){try{e()}catch(e){console.log("err",e),t&&t(e)}}((function(){n(t)}),(function(t){var r;U.error("重写事件triggerHandlers的回调函数发生错误\nType:"+e+"\nName: "+(((r=n)&&"function"==typeof r&&r.name||"<anonymous>")+"\nError: ")+t)}))}))}function pe(e){var t,n;return"<element "+((null===(t=e.currentTarget)||void 0===t?void 0:t.id)?' id="'+(null===(n=e.currentTarget)||void 0===n?void 0:n.id)+'"':"")+" "+Object.keys(e.currentTarget.dataset).map((function(t){return"data-"+t+"="+e.currentTarget.dataset[t]})).join(" ")+"/>"}function fe(){return n(this,void 0,void 0,(function(){var e,t,n,o,a;return r(this,(function(r){switch(r.label){case 0:return e=wx.getSystemInfoSync(),t=e.pixelRatio,n=e.screenHeight,o=e.screenWidth,[4,he()];case 1:return a=r.sent(),[2,{ratio:t,clientHeight:n,clientWidth:o,netType:a}]}}))}))}function he(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,new Promise((function(e,t){wx.getNetworkType({success:function(t){e(t.networkType)},fail:function(t){console.error("获取微信小程序网络类型失败:"+t),e("getNetWrokType failed")}})}))]}))}))}!function(e){e.Touchmove="touchmove",e.Tap="tap",e.Longtap="longtap",e.Longpress="longpress"}(se||(se={}));var de={onLaunch:function(e){ae.appOnLauch(e);var t={path:e.path,query:e.query};K.push({category:K.getCategory(u.APP_ON_LAUNCH),type:u.APP_ON_LAUNCH,data:t,level:B.Info})},onShow:function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return ae.appOnShow(e),t={path:e.path,query:e.query},K.push({category:K.getCategory(u.APP_ON_SHOW),type:u.APP_ON_SHOW,data:t,level:B.Info}),n=N,[4,fe()];case 1:return n.deviceInfo=r.sent(),[2]}}))}))},onHide:function(){ae.appOnHide(),K.push({category:K.getCategory(u.APP_ON_HIDE),type:u.APP_ON_HIDE,data:null,level:B.Info})},onError:function(e){var n=function(e){var t=e.split("\n");if(t.length<2)return null;-1!==t[0].indexOf("MiniProgramError")&&t.splice(0,1);var n=t.splice(0,1)[0],r=t.splice(0,1)[0].split(":")[0],o=[];return t.forEach((function(e){var t=/at\s+([\S]+)\s+\(/.exec(e),n=/\(([^)]+)\)/.exec(e);n||(n=/\s+at\s+(\S+)/.exec(e));var r=Array.isArray(t)&&t.length>0?t[1].trim():"",i=(Array.isArray(n)&&n.length>0?n[1]:"").split(":");o.push({args:[],func:r||a.UNKNOWN_FUNCTION,column:Number(i.pop()),line:Number(i.pop()),url:i.join(":")})})),{message:n,name:r,stacks:o}}(e),r=t(t({},n),{time:k(),level:B.Normal,url:j(),type:a.JAVASCRIPT_ERROR});K.push({category:K.getCategory(u.CODE_ERROR),type:u.CODE_ERROR,level:B.Error,data:t({},r)}),te.send(r)},onUnhandledRejection:function(e){var n={type:a.PROMISE_ERROR,message:M(e.reason),url:j(),name:"unhandledrejection",time:k(),level:B.Low};R(e.reason)&&(n=t(t(t({},n),G(e.reason,B.Low)),{url:j()})),K.push({type:u.UNHANDLEDREJECTION,category:K.getCategory(u.UNHANDLEDREJECTION),data:t({},n),level:B.Error}),te.send(n)},onPageNotFound:function(e){ae.onPageNotFound(e),K.push({category:K.getCategory(u.ROUTE),type:u.ROUTE,data:e,level:B.Error})}},ge={onShow:function(){var e=getCurrentPages().pop();ae.pageOnShow(e);var t={path:e.route,query:e.options};K.push({category:K.getCategory(u.PAGE_ON_SHOW),type:u.PAGE_ON_SHOW,data:t,level:B.Info})},onHide:function(){var e=getCurrentPages().pop();ae.pageOnHide(e);var t={path:e.route,query:e.options};K.push({category:K.getCategory(u.PAGE_ON_HIDE),type:u.PAGE_ON_HIDE,data:t,level:B.Info})},onShareAppMessage:function(e){var n=getCurrentPages().pop();ae.onShareAppMessage(t(t({},n),e));var r={path:n.route,query:n.options,options:e};K.push({category:K.getCategory(u.PAGE_ON_SHARE_APP_MESSAGE),type:u.PAGE_ON_SHARE_APP_MESSAGE,data:r,level:B.Info})},onShareTimeline:function(){var e=getCurrentPages().pop();ae.onShareTimeline(e);var t={path:e.route,query:e.options};K.push({category:K.getCategory(u.PAGE_ON_SHARE_TIMELINE),type:u.PAGE_ON_SHARE_TIMELINE,data:t,level:B.Info})},onTabItemTap:function(e){var n=getCurrentPages().pop();ae.onTabItemTap(t(t({},n),e));var r={path:n.route,query:n.options,options:e};K.push({category:K.getCategory(u.PAGE_ON_TAB_ITEM_TAP),type:u.PAGE_ON_TAB_ITEM_TAP,data:r,level:B.Info})},onAction:function(e){var t=u.TOUCHMOVE;e.type===se.Tap&&(t=u.TAP),K.push({category:K.getCategory(t),type:t,data:pe(e),level:B.Info})}},Oe=function(e){!function(e){d.isLogAddBreadcrumb&&K.push({type:u.CONSOLE,category:K.getCategory(u.CONSOLE),data:e,level:B.fromString(e.level)})}(e)},Ee=function(e){var n=re(e);n.url=j(),void 0===e.status&&(n.message=e.errMsg);var r,o=u.XHR;K.push({type:o,category:K.getCategory(o),data:n,level:B.Info}),(0===(r=e.status)||r===h.BAD_REQUEST||r>h.UNAUTHORIZED)&&(K.push({type:o,category:K.getCategory(u.CODE_ERROR),data:t({},n),level:B.Error}),te.send(n))},Re=function(e){if(e.isFail){K.push({type:u.ROUTE,category:K.getCategory(u.CODE_ERROR),data:e,level:B.Error});var t={type:a.ROUTE_ERROR,message:e.message,url:e.to,name:"MINI_"+a.ROUTE_ERROR,level:B.Error};return te.send(t)}K.push({type:u.ROUTE,category:K.getCategory(u.ROUTE),data:e,level:B.Info})};function ye(e){return ae.filterXhrUrlRegExp&&ae.filterXhrUrlRegExp.test(e)}function ve(e){switch(e){case p.CONSOLE:!function(){if(console&&E.isObject(console)){["log","debug","info","warn","error","assert"].forEach((function(e){e in console&&H(console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&(le(p.CONSOLE,{args:n,level:e}),t.apply(console,n))}}))}))}}();break;case p.XHR:["request","downloadFile","uploadFile"].forEach((function(e){var n=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var a,i=r[0];a=i.method?i.method:"downloadFile"===e?q.Get:q.Post;var c,s=i.url,u=i.header;if(a===q.Post&&te.isSdkTransportUrl(s)||ye(s))return n.call(this,i);c="request"===e?i.data:"downloadFile"===e?{filePath:i.filePath}:{filePath:i.filePath,name:i.name};var l={type:f.XHR,method:a,url:s,reqData:c,sTime:k()};function h(e,t){u[e]=t}ie(s,(function(e,t){l.traceId=t,u[e]=t})),ae.beforeAppAjaxSend&&ae.beforeAppAjaxSend({method:a,url:s},{setRequestHeader:h});var d=function(e){var t=k();if(l.responseText=(E.isString(e.data)||E.isObject(e.data))&&e.data,l.elapsedTime=t-l.sTime,l.status=e.statusCode,l.errMsg=e.errMsg,le(p.XHR,l),"function"==typeof i.success)return i.success(e)},g=i.fail,O=function(e){var t=k();if(l.elapsedTime=t-l.sTime,l.errMsg=e.errMsg,le(p.XHR,l),E.isFunction(g))return g(e)},R=t(t({},i),{success:d,fail:O});return n.call(this,R)}})}));break;case p.MINI_ROUTE:[s.SwitchTab,s.ReLaunch,s.RedirectTo,s.NavigateTo,s.NavigateBack].forEach((function(e){var n=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(r){var o,a;a=e===s.NavigateBack?function(e){if(!E.isFunction(getCurrentPages))return"";var t=getCurrentPages();if(!t.length)return"App";e=e||1;var n=t[t.length-e];return L(n.route,n.options)}(null===(o=r)||void 0===o?void 0:o.delta):r.url;var i={from:j(),to:a};if(le(p.MINI_ROUTE,i),E.isFunction(r.complete)||E.isFunction(r.success)||E.isFunction(r.fail)){var c=r.fail;r.fail=function(e){var n=t(t({},i),{isFail:!0,message:e.errMsg});if(le(p.MINI_ROUTE,n),E.isFunction(c))return c(e)}}return n.call(this,r)}})}))}}function Te(e){(function(e){return!(!e||I(e.type))&&(P(e.type,!0),ue[e.type]=ue[e.type]||[],ue[e.type].push(e.callback),!0)})(e)&&ve(e.type)}var me=[c.PageOnShow,c.PageOnHide,c.PageOnShareAppMessage,c.PageOnShareTimeline,c.PageOnTabItemTap];function be(e){me.forEach((function(t){H(e,t.replace("PageOn","on"),(function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];le.apply(null,o([t],n)),e&&e.apply(this,n)}}),!0)}))}function Ae(e){var t,n,r,o=(t=function(e){e.mitoWorked=!0,le(p.DOM,e)},n=500,r=!0,function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r&&(t.apply(this,e),r=!1,setTimeout((function(){r=!0}),n))}),a=[se.Touchmove,se.Tap];Object.keys(e).forEach((function(t){"function"==typeof e[t]&&H(e,t,(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0];return r&&r.type&&r.currentTarget&&!r.mitoWorked&&a.indexOf(r.type)>-1&&o(r),e.apply(this,t)}}),!0)}))}function Ne(){!function(){if(App){var e=App;App=function(t){return[i.AppOnLaunch,i.AppOnShow,i.AppOnError,i.AppOnUnhandledRejection,i.AppOnPageNotFound,i.AppOnHide].forEach((function(e){I(e)||(Te({callback:function(t){return de[e.replace("AppOn","on")](t)},type:e}),H(t,e.replace("AppOn","on"),(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];le.apply(null,o([e],n)),t&&t.apply(this,n)}}),!0))})),e(t)}}}(),function(){if(Page){var e=Page;me.forEach((function(e){I(e)||Te({callback:function(t){return ge[e.replace("PageOn","on")](t)},type:e})})),Page=function(t){return be(t),Ae(t),e.call(this,t)}}}(),function(){if(Component){var e=Component;Component=function(t){return y(t.methods)||(be(t.methods),Ae(t.methods)),e.call(this,t)}}}(),function(){if(Behavior){var e=Behavior;Behavior=function(t){return y(t.methods)||Ae(t.methods),e.call(this,t)}}}(),Te({callback:function(e){return Re(e)},type:p.MINI_ROUTE}),Te({callback:function(e){Ee(e)},type:p.XHR}),Te({callback:function(e){Oe(e)},type:p.CONSOLE}),Te({callback:function(e){return ge.onAction(e)},type:p.DOM})}function _e(e){var n=F(),r=k();te.send(t({id:n,startTime:r},e))}return e.init=function(e){void 0===e&&(e={}),m&&(ce(e),Ne(),Object.assign(wx,{mitoLog:ne}))},e.log=ne,e.sendTrackData=_e,e.track=function(e,t){_e({actionType:e,trackId:t.trackId})},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
