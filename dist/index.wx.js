"use strict";var e,t,n,r,a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function o(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,c=o.length;i<c;i++,a++)r[a]=o[i];return r}!function(e){e.UNKNOWN="UNKNOWN",e.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",e.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",e.LOG_ERROR="LOG_ERROR",e.FETCH_ERROR="HTTP_ERROR",e.VUE_ERROR="VUE_ERROR",e.REACT_ERROR="REACT_ERROR",e.RESOURCE_ERROR="RESOURCE_ERROR",e.PROMISE_ERROR="PROMISE_ERROR",e.MINIPROGRAM_REQUEST_ERROR="MINIPROGRAM_REQUEST_ERROR",e.ROUTE_ERROR="ROUTE_ERROR"}(e||(e={})),function(e){e.AppOnLaunch="AppOnLaunch",e.AppOnShow="AppOnShow",e.AppOnHide="AppOnHide",e.AppOnError="AppOnError",e.AppOnPageNotFound="AppOnPageNotFound",e.AppOnUnhandledRejection="AppOnUnhandledRejection"}(t||(t={})),function(e){e.PageOnShow="PageOnShow",e.PageOnHide="PageOnHide",e.PageOnShareAppMessage="PageOnShareAppMessage",e.PageOnShareTimeline="PageOnShareTimeline",e.PageOnTabItemTap="PageOnTabItemTap"}(n||(n={})),function(e){e.SwitchTab="switchTab",e.ReLaunch="reLaunch",e.RedirectTo="redirectTo",e.NavigateTo="navigateTo",e.NavigateBack="navigateBack",e.RouteFail="routeFail"}(r||(r={}));var i,c,s,u,l;a(a(a({},t),n),e);!function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.XHR="Xhr",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.VUE="Vue",e.REACT="React",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer",e.APP_ON_SHOW="App On Show",e.APP_ON_LAUNCH="App On Launch",e.APP_ON_HIDE="App On Hide",e.PAGE_ON_SHOW="Page On Show",e.PAGE_ON_HIDE="Page On Hide",e.PAGE_ON_SHARE_APP_MESSAGE="Page On Share App Message",e.PAGE_ON_SHARE_TIMELINE="Page On Share Timeline",e.PAGE_ON_TAB_ITEM_TAP="Page On Tab Item Tap",e.TAP="UI.Tap",e.TOUCHMOVE="UI.Touchmove",e.MINIPROGRAM_REQUEST="Miniprogram Request"}(i||(i={})),function(e){e.HTTP="http",e.USER="user",e.DEBUG="debug",e.EXCEPTION="exception",e.LIFECYCLE="lifecycle",e.NETWORK="network"}(c||(c={})),function(e){e.XHR="xhr",e.FETCH="fetch",e.CONSOLE="console",e.DOM="dom",e.HISTORY="history",e.ERROR="error",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.MITO="mito",e.VUE="Vue",e.MINI_ROUTE="miniRoute"}(s||(s={})),function(e){e.XHR="xhr",e.FETCH="fetch"}(u||(u={})),function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(l||(l={}));var p=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/,f={isLogAddBreadcrumb:!0,crossOriginThreshold:1e3},d=Object.prototype.toString;function h(e){return function(t){return d.call(t)==="[object "+e+"]"}}var E={isNumber:h("Number"),isString:h("String"),isBoolean:h("Boolean"),isNull:h("Null"),isUndefined:h("Undefined"),isSymbol:h("Symbol"),isFunction:h("Function"),isObject:h("Object"),isArray:h("Array"),isProcess:h("process"),isWindow:h("Window")};function g(e){switch(d.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}var O=E.isProcess("undefined"!=typeof process?process:0),R=E.isObject("undefined"!=typeof wx?wx:0)&&E.isFunction("undefined"!=typeof App?App:0),y=E.isWindow("undefined"!=typeof window?window:0);var v=y?window:R?wx:O?process:void 0,m=(v.__MITO__=v.__MITO__||{},v.__MITO__);m.replaceFlag=m.replaceFlag||{};var T=m.replaceFlag;function N(e,t){T[e]||(T[e]=t)}function _(e){return!!T[e]}var A="MITO Logger",P=function(){function e(){var e=this;if(this.enabled=!1,this._console={},v.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in v.console&&(e._console[t]=v.console[t])}))}}return e.prototype.disable=function(){this.enabled=!1},e.prototype.bindOptions=function(e){this.enabled=!!e},e.prototype.enable=function(){this.enabled=!0},e.prototype.getEnableStatus=function(){return this.enabled},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).log.apply(e,o([A+"[Log]:"],t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).warn.apply(e,o([A+"[Warn]:"],t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).error.apply(e,o([A+"[Error]:"],t))},e}(),b=m.logger||(m.logger=new P);function I(){return"undefined"==typeof document||null==document.location?"":document.location.href}function C(e,t,n,r){if(void 0===r&&(r=!1),t in e||r){var a=n(e[t]);"function"==typeof a&&(e[t]=a)}}function S(){return Date.now()}function U(e,t,n){return!!function(e,t){return typeof e===t}(e,n)||(void 0!==e&&b.error(t+"期望传入"+n+"类型，目前是"+typeof e+"类型"),!1)}function x(e,t,n){return!!function(e,t){return d.call(e)===t}(e,n)||(void 0!==e&&b.error(t+"期望传入"+n+"类型，目前是"+d.call(e)+"类型"),!1)}function H(e){return E.isString(e)?e:JSON.stringify(e)}function k(e,t){var n=[];return Object.keys(t).forEach((function(e){n.push(e+"="+t[e])})),e=-1!==e.indexOf("?")?e+"&"+n.join("&"):e+"?"+n.join("&")}function w(e){if(!e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function D(t,n){var r={time:S(),url:I(),name:t.name,level:n,message:t.message};if(void 0===t.stack||!t.stack)return r;for(var o,i,c,s=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,u=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,l=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,p=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,f=/\((\S*)(?::(\d+))(?::(\d+))\)/,d=t.stack.split("\n"),h=[],E=0,g=d.length;E<g;++E){if(i=s.exec(d[E])){var O=i[2]&&0===i[2].indexOf("native");i[2]&&0===i[2].indexOf("eval")&&(o=f.exec(i[2]))&&(i[2]=o[1],i[3]=o[2],i[4]=o[3]),c={url:O?null:i[2],func:i[1]||e.UNKNOWN_FUNCTION,args:O?[i[2]]:[],line:i[3]?+i[3]:null,column:i[4]?+i[4]:null}}else if(i=l.exec(d[E]))c={url:i[2],func:i[1]||e.UNKNOWN_FUNCTION,args:[],line:+i[3],column:i[4]?+i[4]:null};else{if(!(i=u.exec(d[E])))continue;i[3]&&i[3].indexOf(" > eval")>-1&&(o=p.exec(i[3]))?(i[3]=o[1],i[4]=o[2],i[5]=null):0!==E||i[5]||void 0===t.columnNumber||(h[0].column=t.columnNumber+1),c={url:i[3],func:i[1]||e.UNKNOWN_FUNCTION,args:i[2]?i[2].split(","):[],line:i[4]?+i[4]:null,column:i[5]?+i[5]:null}}!c.func&&c.line&&(c.func=e.UNKNOWN_FUNCTION),h.push(c)}return h.length?a(a({},r),{stack:h}):null}var M=function(){function e(){this.stack=[],this.isFlushing=!1,"Promise"in v&&(this.micro=Promise.resolve())}return e.prototype.addFn=function(e){var t=this;"function"==typeof e&&("Promise"in v?(this.stack.push(e),this.isFlushing||(this.isFlushing=!0,this.micro.then((function(){return t.flushStack()})))):e())},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.flushStack=function(){var e=this.stack.slice(0);this.stack.length=0,this.isFlushing=!1;for(var t=0;t<e.length;t++)e[t]()},e}(),L=function(){function e(){this.maxBreadcrumbs=10,this.beforePushBreadcrumb=null,this.stack=[]}return e.prototype.push=function(e){var t=this;if("function"!=typeof this.beforePushBreadcrumb){var n;this.immediatePush(e)}else{var r=null,a=this.beforePushBreadcrumb;if(n=function(){r=a(t,e)},f.isLogAddBreadcrumb=!1,n(),f.isLogAddBreadcrumb=!0,!r)return;this.immediatePush(r)}},e.prototype.immediatePush=function(e){e.time=S(),this.stack.length>=this.maxBreadcrumbs&&this.shift(),this.stack.push(e),b.log(this.stack)},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.getCategory=function(e){switch(e){case i.XHR:case i.FETCH:return c.HTTP;case i.CLICK:case i.ROUTE:case i.TAP:case i.TOUCHMOVE:return c.USER;case i.CUSTOMER:case i.CONSOLE:return c.DEBUG;case i.APP_ON_LAUNCH:case i.APP_ON_SHOW:case i.APP_ON_HIDE:case i.PAGE_ON_SHOW:case i.PAGE_ON_HIDE:case i.PAGE_ON_SHARE_APP_MESSAGE:case i.PAGE_ON_SHARE_TIMELINE:case i.PAGE_ON_TAB_ITEM_TAP:return c.LIFECYCLE;case i.MINIPROGRAM_REQUEST:return c.NETWORK;case i.UNHANDLEDREJECTION:case i.CODE_ERROR:case i.RESOURCE:case i.VUE:case i.REACT:default:return c.EXCEPTION}},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.maxBreadcrumbs,n=e.beforePushBreadcrumb;U(t,"maxBreadcrumbs","number")&&(this.maxBreadcrumbs=t),U(n,"beforePushBreadcrumb","function")&&(this.beforePushBreadcrumb=n)},e}(),F=m.breadcrumb||(m.breadcrumb=new L),j={};function G(t){var n,r=function(e){if(/^file:\/\//.test(e))return function(e){return W(function(e){return e.replace(/(\S+)(\/Documents\/)(\S*)/,"$3")}(e))}(e);return X(W(e).replace(/(\S*)(\/\/)(\S+)/,"$3"))}(t.url);switch(t.type){case e.FETCH_ERROR:n=t.type+t.request.method+t.response.status+X(t.request.url)+r;break;case e.JAVASCRIPT_ERROR:case e.VUE_ERROR:case e.REACT_ERROR:n=t.type+t.name+t.message+r;break;case e.LOG_ERROR:n=t.customTag+t.type+t.name+r;break;case e.PROMISE_ERROR:n=function(e,t){var n=X(e.url);if(e.name===s.UNHANDLEDREJECTION)return e.type+B(e.message)+t;return e.type+e.name+B(e.message)+n}(t,r);break;default:n=t.type+t.message+r}return n=function(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(n),j[n]>1?null:("number"==typeof j[n]?j[n]++:j[n]=1,n)}function B(e){var t=function(e){return Object.keys(e).sort().reduce((function(n,r){return E.isObject(e[r])?n[r]=t(e[r]):n[r]=e[r],n}),{})};try{if(/\{.*\}/.test(e)){var n=JSON.parse(e);return n=t(n),JSON.stringify(n)}}catch(t){return e}}function X(e){return e.replace(/[\?#].*$/,"").replace(/\/\d+([\/]*$)/,"{param}$1")}function W(e){return e.replace(/(\S+)(\/#\/)(\S*)/,"$1")}var q;!function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(q||(q={}));var V,J,K=function(){function e(e){this.url=e,this.beforeDataReport=null,this.backTrackerId=null,this.configReportXhr=null,this.apikey="",this.queue=new M}return e.prototype.getRecord=function(){var e=m.record;return e&&E.isArray(e)&&e.length>2?e:[]},e.prototype.beforePost=function(e){if("function"==typeof this.beforeDataReport&&!(e=this.beforeDataReport(e)))return!1;var t=G(e);return!!t&&(e.errorId=t,JSON.stringify(this.getTransportData(e)))},e.prototype.xhrPost=function(e){var t=this,n=this.beforePost(e);if(n){this.queue.addFn((function(){var e=new XMLHttpRequest;e.open(q.Post,t.url),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.withCredentials=!0,"function"==typeof t.configReportXhr&&t.configReportXhr(e),e.send(n)}))}},e.prototype.wxPost=function(e){var t=this,n=this.beforePost(e);if(n){this.queue.addFn((function(){wx.request({method:"POST",header:{"Content-Type":"application/json;charset=UTF-8"},url:t.url,data:n})}))}},e.prototype.getAuthInfo=function(){var e=this.getTrackerId();return{trackerId:String(e),sdkVersion:"1.2.3",sdkName:"@zyf2e/mitojs",apikey:this.apikey}},e.prototype.getTrackerId=function(){if("function"==typeof this.backTrackerId){var e=this.backTrackerId();if("string"==typeof e||"number"==typeof e)return e;b.error("trackerId:"+e+" 期望 string 或 number 类型，但是传入 "+typeof e)}return""},e.prototype.getTransportData=function(e){return{authInfo:this.getAuthInfo(),breadcrumb:F.getStack(),data:e,record:this.getRecord()}},e.prototype.isSdkTransportUrl=function(e){return-1!==e.indexOf(this.url)},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.dsn,n=e.beforeDataReport,r=e.apikey,a=e.configReportXhr,o=e.backTrackerId;U(r,"apikey","string")&&(this.apikey=r),U(t,"dsn","string")&&(this.url=t),U(n,"beforeDataReport","function")&&(this.beforeDataReport=n),U(a,"configReportXhr","function")&&(this.configReportXhr=a),U(o,"backTrackerId","function")&&(this.backTrackerId=o)},e.prototype.send=function(e){return y?this.xhrPost(e):R?this.wxPost(e):void 0},e}(),$=m.transportData||(m.transportData=new K("//localhost:3000/api/error/upload")),Q=function(){function e(){this.traceIdFieldName="Trace-Id",this.enableTraceId=!1}return e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.beforeAppAjaxSend,n=e.enableTraceId,r=e.filterXhrUrlRegExp,a=e.traceIdFieldName,o=e.includeHttpUrlTraceIdRegExp;U(t,"beforeAppAjaxSend","function")&&(this.beforeAppAjaxSend=t),U(n,"enableTraceId","boolean")&&(this.enableTraceId=n),U(a,"traceIdFieldName","string")&&(this.traceIdFieldName=a),x(r,"filterXhrUrlRegExp","[object RegExp]")&&(this.filterXhrUrlRegExp=r),x(o,"includeHttpUrlTraceIdRegExp","[object RegExp]")&&(this.includeHttpUrlTraceIdRegExp=o)},e}(),Y=m.options||(m.options=new Q);function Z(e,t){var n,r=Y.includeHttpUrlTraceIdRegExp;if(Y.enableTraceId&&r&&r.test(e)){var a=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})));t(Y.traceIdFieldName,a)}}function z(e){var t;void 0===e&&(e={}),void 0===(t=e)&&(t={}),N(s.XHR,!!t.silentXhr),N(s.FETCH,!!t.silentFetch),N(s.CONSOLE,!!t.silentConsole),N(s.DOM,!!t.silentDom),N(s.HISTORY,!!t.silentHistory),N(s.ERROR,!!t.silentError),N(s.HASHCHANGE,!!t.silentHashchange),N(s.UNHANDLEDREJECTION,!!t.silentUnhandledrejection),N(s.VUE,!!t.silentVue),F.bindOptions(e),b.bindOptions(e.debug),$.bindOptions(e),Y.bindOptions(e)}function ee(t){var n="",r=t.elapsedTime,a=t.time,o=t.method,i=t.traceId,c=t.type,s=t.status;return n=0===s?r<=f.crossOriginThreshold?"http请求失败，失败原因：跨域限制或域名不存在":"http请求失败，失败原因：超时":function(e){if(e<400)return J.Ok;if(e>=400&&e<500)switch(e){case 401:return J.Unauthenticated;case 403:return J.PermissionDenied;case 404:return J.NotFound;case 409:return J.AlreadyExists;case 413:return J.FailedPrecondition;case 429:return J.ResourceExhausted;default:return J.InvalidArgument}if(e>=500&&e<600)switch(e){case 501:return J.Unimplemented;case 503:return J.Unavailable;case 504:return J.DeadlineExceeded;default:return J.InternalError}return J.UnknownError}(s),{type:e.FETCH_ERROR,url:I(),time:a,elapsedTime:r,level:V.Low,message:n,name:c+"--"+o,request:{httpType:c,traceId:i,method:o,url:t.url,data:t.reqData||""},response:{status:s,data:t.responseText}}}!function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}(V||(V={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":case"log":case"assert":return e.Info;case"warn":case"warning":return e.Warning;case e.Low:case e.Normal:case e.High:case e.Critical:case"error":return e.Error;default:return e.Else}}}(V||(V={})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(J||(J={}));var te={img:"图片",script:"js脚本"};function ne(){if(!E.isFunction(getCurrentPages))return"";var e=getCurrentPages();if(!e.length)return"App";var t=e.pop();return k(t.route,t.options)}function re(e){var t,n;return"<element "+((null===(t=e.currentTarget)||void 0===t?void 0:t.id)?' id="'+(null===(n=e.currentTarget)||void 0===n?void 0:n.id)+'"':"")+" "+Object.keys(e.currentTarget.dataset).map((function(t){return"data-"+t+"="+e.currentTarget.dataset[t]})).join(" ")+"/>"}var ae,oe={handleHttp:function(e,t){var n=0===e.status||e.status===l.BAD_REQUEST||e.status>l.UNAUTHORIZED,r=ee(e);F.push({type:t,category:F.getCategory(t),data:r,level:V.Info}),n&&(F.push({type:t,category:F.getCategory(i.CODE_ERROR),data:r,level:V.Error}),$.send(r))},handleError:function(t){if(t.target.localName){var n=function(t){return{type:e.RESOURCE_ERROR,url:I(),message:"资源地址: "+(t.src.slice(0,100)||t.href.slice(0,100)),level:V.Low,time:S(),name:(te[t.localName]||t.localName)+"加载失败"}}(t.target);return F.push({type:i.RESOURCE,category:F.getCategory(i.RESOURCE),data:n,level:V.Error}),$.send(n)}var r,a=t.message,o=t.filename,c=t.lineno,s=t.colno,u=t.error;u&&g(u)&&(r=D(u,V.Normal)),r||(r=oe.handleNotErrorInstance(a,o,c,s)),r.type=e.JAVASCRIPT_ERROR,F.push({type:i.CODE_ERROR,category:F.getCategory(i.CODE_ERROR),data:r,level:V.Error}),$.send(r)},handleNotErrorInstance:function(t,n,r,a){var o=e.UNKNOWN,i=n||I(),c=t,s=t.match(p);s[1]&&(o=s[1],c=s[2]);var u={url:i,func:e.UNKNOWN_FUNCTION,args:e.UNKNOWN,line:r,col:a};return{url:i,name:o,message:c,level:V.Normal,time:S(),stack:[u]}},handleHistory:function(e){var t=e.from,n=e.to,r=w(t).relative,a=w(n).relative;F.push({type:i.ROUTE,category:F.getCategory(i.ROUTE),data:{from:r||"/",to:a||"/"},level:V.Info})},handleHashchange:function(e){var t=e.oldURL,n=e.newURL,r=w(t).relative,a=w(n).relative;F.push({type:i.ROUTE,category:F.getCategory(i.ROUTE),data:{from:r,to:a},level:V.Info})},handleUnhandleRejection:function(t){var n={type:e.PROMISE_ERROR,message:H(t.reason),url:I(),name:t.type,time:S(),level:V.Low};g(t.reason)&&(n=a(a({},n),D(t.reason,V.Low))),F.push({type:i.UNHANDLEDREJECTION,category:F.getCategory(i.UNHANDLEDREJECTION),data:n,level:V.Error}),$.send(n)},handleConsole:function(e){f.isLogAddBreadcrumb&&F.push({type:i.CONSOLE,category:F.getCategory(i.CONSOLE),data:e,level:V.fromString(e.level)})}};!function(e){e.Touchmove="touchmove",e.Tap="tap"}(ae||(ae={}));var ie=wx.getAccountInfoSync().miniProgram,ce=(ie.appId,ie.envVersion,ie.version,{onLaunch:function(e){var t={path:e.path,query:e.query};F.push({category:F.getCategory(i.APP_ON_LAUNCH),type:i.APP_ON_LAUNCH,data:t,level:V.Info})},onShow:function(e){var t={path:e.path,query:e.query};F.push({category:F.getCategory(i.APP_ON_SHOW),type:i.APP_ON_SHOW,data:t,level:V.Info})},onHide:function(){F.push({category:F.getCategory(i.APP_ON_HIDE),type:i.APP_ON_HIDE,data:null,level:V.Info})},onError:function(t){var n=function(t){var n=t.split("\n");if(n.length<2)return null;-1!==n[0].indexOf("MiniProgramError")&&n.splice(0,1);var r=n.splice(0,1)[0],a=n.splice(0,1)[0].split(":")[0],o=[];return n.forEach((function(t){var n=/at\s+([\S]+)\s+\(/.exec(t),r=/\(([^)]+)\)/.exec(t);r||(r=/\s+at\s+(\S+)/.exec(t));var a=Array.isArray(n)&&n.length>0?n[1].trim():"",i=(Array.isArray(r)&&r.length>0?r[1]:"").split(":");o.push({args:[],func:a||e.UNKNOWN_FUNCTION,column:Number(i.pop()),line:Number(i.pop()),url:i.join(":")})})),{message:r,name:a,stacks:o}}(t),r=a(a({},n),{time:S(),level:V.Normal,url:ne(),type:e.JAVASCRIPT_ERROR});F.push({category:F.getCategory(i.CODE_ERROR),type:i.CODE_ERROR,level:V.Error,data:r}),$.send(r)},onUnhandledRejection:function(t){var n={type:e.PROMISE_ERROR,message:H(t.reason),url:ne(),name:"unhandledrejection",time:S(),level:V.Low};g(t.reason)&&(n=a(a(a({},n),D(t.reason,V.Low)),{url:ne()})),F.push({type:i.UNHANDLEDREJECTION,category:F.getCategory(i.UNHANDLEDREJECTION),data:n,level:V.Error}),$.send(n)},onPageNotFound:function(e){F.push({category:F.getCategory(i.ROUTE),type:i.ROUTE,data:e,level:V.Error})}}),se={onShow:function(){var e=getCurrentPages().pop(),t={path:e.route,query:e.options};F.push({category:F.getCategory(i.PAGE_ON_SHOW),type:i.PAGE_ON_SHOW,data:t,level:V.Info})},onHide:function(){var e=getCurrentPages().pop(),t={path:e.route,query:e.options};F.push({category:F.getCategory(i.PAGE_ON_HIDE),type:i.PAGE_ON_HIDE,data:t,level:V.Info})},onShareAppMessage:function(e){var t=getCurrentPages().pop(),n={path:t.route,query:t.options,options:e};F.push({category:F.getCategory(i.PAGE_ON_SHARE_APP_MESSAGE),type:i.PAGE_ON_SHARE_APP_MESSAGE,data:n,level:V.Info})},onShareTimeline:function(){var e=getCurrentPages().pop(),t={path:e.route,query:e.options};F.push({category:F.getCategory(i.PAGE_ON_SHARE_TIMELINE),type:i.PAGE_ON_SHARE_TIMELINE,data:t,level:V.Info})},onTabItemTap:function(e){var t=getCurrentPages().pop(),n={path:t.route,query:t.options,options:e};F.push({category:F.getCategory(i.PAGE_ON_TAB_ITEM_TAP),type:i.PAGE_ON_TAB_ITEM_TAP,data:n,level:V.Info})},onAction:function(e){var t=i.TOUCHMOVE;e.type===ae.Tap&&(t=i.TAP),F.push({category:F.getCategory(t),type:t,data:re(e),level:V.Info})}},ue=function(e){oe.handleConsole(e)},le=function(e){var t=ee(e);t.url=ne(),void 0===e.status&&(t.message=e.errMsg);var n,r=i.XHR;F.push({type:r,category:F.getCategory(r),data:t,level:V.Info}),(0===(n=e.status)||n===l.BAD_REQUEST||n>l.UNAUTHORIZED)&&(F.push({type:r,category:F.getCategory(i.CODE_ERROR),data:t,level:V.Error}),$.send(t))},pe=function(t){if(t.isFail){F.push({type:i.ROUTE,category:F.getCategory(i.CODE_ERROR),data:t,level:V.Error});var n={type:e.ROUTE_ERROR,message:t.errMsg,url:t.to,name:"MINI_"+e.ROUTE_ERROR,level:V.Error};return $.send(n)}F.push({type:i.ROUTE,category:F.getCategory(i.ROUTE),data:t,level:V.Info})},fe={};function de(e,t){e&&fe[e]&&fe[e].forEach((function(n){!function(e,t){try{e()}catch(e){console.log("err",e),t&&t(e)}}((function(){n(t)}),(function(t){var r;b.error("重写事件triggerHandlers的回调函数发生错误\nType:"+e+"\nName: "+(((r=n)&&"function"==typeof r&&r.name||"<anonymous>")+"\nError: ")+t)}))}))}function he(e){return Y.filterXhrUrlRegExp&&Y.filterXhrUrlRegExp.test(e)}function Ee(e){switch(e){case s.CONSOLE:!function(){if(console&&E.isObject(console)){["log","debug","info","warn","error","assert"].forEach((function(e){e in console&&C(console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&(de(s.CONSOLE,{args:n,level:e}),t.apply(console,n))}}))}))}}();break;case s.XHR:["request","downloadFile","uploadFile"].forEach((function(e){var t=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o,i=n[0];o=i.method?i.method:"downloadFile"===e?q.Get:q.Post;var c,l=i.url,p=i.header;if(o===q.Post&&$.isSdkTransportUrl(l)||he(l))return t.call(this,i);c="request"===e?i.data:"downloadFile"===e?{filePath:i.filePath}:{filePath:i.filePath,name:i.name};var f={type:u.XHR,method:o,url:l,reqData:c,sTime:S()};function d(e,t){p[e]=t}Z(l,(function(e,t){f.traceId=t,p[e]=t})),Y.beforeAppAjaxSend&&Y.beforeAppAjaxSend({method:o,url:l},{setRequestHeader:d});var h=function(e){var t=S();if(f.responseText=(E.isString(e.data)||E.isObject(e.data))&&e.data,f.elapsedTime=t-f.sTime,f.status=e.statusCode,f.errMsg=e.errMsg,de(s.XHR,f),"function"==typeof i.success)return i.success(e)},g=function(e){var t=S();if(f.elapsedTime=t-f.sTime,f.errMsg=e.errMsg,de(s.XHR,f),"function"==typeof i.fail)return i.fail(e)},O=a(a({},i),{success:h,fail:g});return t.call(this,O)}})}));break;case s.MINI_ROUTE:[r.SwitchTab,r.ReLaunch,r.RedirectTo,r.NavigateTo,r.NavigateBack].forEach((function(e){var t=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(n){var o;getCurrentPages(),o=e===r.NavigateBack?function(e){if(!E.isFunction(getCurrentPages))return"";var t=getCurrentPages();if(!t.length)return"App";e=e||1;var n=t[t.length-e];return k(n.route,n.options)}(n.delta):n.url;var i={from:ne(),to:o};return de(s.MINI_ROUTE,i),(E.isFunction(n.complete)||E.isFunction(n.success)||E.isFunction(n.fail))&&(n.fail=function(e){var t=a(a({},i),{isFail:!0,message:e.errMsg});if(de(s.MINI_ROUTE,t),E.isFunction(n.fail))return n.fail(e)}),t.call(this,n)}})}))}}function ge(e){!function(e){e&&(fe[e.type]=fe[e.type]||[],fe[e.type].push(e.callback))}(e),_(e.type)||(N(e.type,!0),Ee(e.type))}function Oe(){if(Page){var e=Page;Page=function(t){var r=[n.PageOnShow,n.PageOnHide,n.PageOnShareAppMessage,n.PageOnShareTimeline,n.PageOnTabItemTap];r.forEach((function(e){ge({callback:function(t){return se[e.replace("PageOn","on")](t)},type:e}),C(t,e.replace("PageOn","on"),(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];de.apply(null,o([e],n)),t&&t.apply(this,n)}}),!0)})),ge({callback:function(e){return se.onAction(e)},type:s.DOM});var a,i,c,u=(a=function(e){e.mitoProcessed=!0,de(s.DOM,e)},i=500,c=!0,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c&&(a.apply(this,e),c=!1,setTimeout((function(){c=!0}),i))}),l=[ae.Touchmove,ae.Tap];return Object.keys(t).forEach((function(e){var n;"function"!=typeof t[e]||(n=e,r.find((function(e){return e.replace("PageOn","on")===n})))||C(t,e,(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0];r&&r.type&&r.currentTarget&&!r.mitoProcessed&&l.indexOf(r.type)&&u(r),e.apply(this,t)}}),!0)})),e.call(this,t)}}}function Re(){!function(){if(App){var e=App;App=function(n){return[t.AppOnLaunch,t.AppOnShow,t.AppOnError,t.AppOnUnhandledRejection,t.AppOnPageNotFound,t.AppOnHide].forEach((function(e){ge({callback:function(t){return ce[e.replace("AppOn","on")](t)},type:e}),_(e)||C(n,e.replace("AppOn","on"),(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];de.apply(null,o([e],n)),t&&t.apply(this,n)}}),!0)})),e(n)}}}(),Oe(),ge({callback:function(e){return pe(e)},type:s.MINI_ROUTE}),ge({callback:function(e){le(e)},type:s.XHR}),ge({callback:function(e){ue(e)},type:s.CONSOLE})}var ye={init:function(e){void 0===e&&(e={}),R&&(z(e),Re())},log:function(t){var n=t.message,r=void 0===n?"emptyMsg":n,o=t.tag,c=void 0===o?"":o,s=t.level,u=void 0===s?V.Critical:s,l=t.ex,p=void 0===l?"":l,f={};g(p)&&(f=D(p,u));var d=a({type:e.LOG_ERROR,level:u,message:H(r),name:"MITO.log",customTag:H(c),time:S(),url:I()},f);F.push({type:i.CUSTOMER,category:F.getCategory(i.CUSTOMER),data:r,level:V.fromString(u.toString())}),$.send(d)},SDK_VERSION:"1.2.3",SDK_NAME:"@zyf2e/mitojs"};module.exports=ye;
